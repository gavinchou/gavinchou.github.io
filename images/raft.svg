<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.41.20190308.1641 (20190308.1641)
 -->
<!-- Title: braft Pages: 1 -->
<svg width="2711pt" height="2081pt"
 viewBox="0.00 0.00 2711.44 2081.49" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2077.49)">
<title>braft</title>
<polygon fill="#eeeeee" stroke="transparent" points="-4,4 -4,-2077.49 2707.44,-2077.49 2707.44,4 -4,4"/>
<g id="clust9" class="cluster">
<title>cluster_node_init</title>
<polygon fill="#eeeeee" stroke="black" points="817,-1894.53 817,-2065.49 1837,-2065.49 1837,-1894.53 817,-1894.53"/>
</g>
<g id="clust10" class="cluster">
<title>cluster_service</title>
<polygon fill="#eeeeee" stroke="black" points="8,-1225.29 8,-1617.53 943,-1617.53 943,-1225.29 8,-1225.29"/>
</g>
<!-- ElectionTimer_run -->
<g id="node1" class="node">
<title>ElectionTimer_run</title>
<ellipse fill="#555555" stroke="#555555" cx="1459" cy="-1847.53" rx="44.62" ry="18"/>
<text text-anchor="middle" x="1459" y="-1844.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">ElectionTimer::run</text>
</g>
<!-- NodeImpl_handle_election_timeout -->
<g id="node2" class="node">
<title>NodeImpl_handle_election_timeout</title>
<ellipse fill="#555555" stroke="#555555" cx="1452" cy="-1751.53" rx="76.02" ry="18"/>
<text text-anchor="middle" x="1452" y="-1748.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_election_timeout</text>
</g>
<!-- ElectionTimer_run&#45;&gt;NodeImpl_handle_election_timeout -->
<g id="edge1" class="edge">
<title>ElectionTimer_run&#45;&gt;NodeImpl_handle_election_timeout</title>
<path fill="none" stroke="black" d="M1457.72,-1829.29C1456.69,-1815.51 1455.23,-1795.93 1454.05,-1780"/>
<polygon fill="black" stroke="black" points="1457.51,-1779.38 1453.28,-1769.67 1450.53,-1779.9 1457.51,-1779.38"/>
<text text-anchor="middle" x="1479" y="-1797.23" font-family="Times,serif" font-size="7.00">election timeout</text>
</g>
<!-- NodeImpl_reset_leader_id -->
<g id="node4" class="node">
<title>NodeImpl_reset_leader_id</title>
<ellipse fill="#555555" stroke="#555555" cx="1452" cy="-1671.53" rx="58.98" ry="18"/>
<text text-anchor="middle" x="1452" y="-1668.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::reset_leader_id</text>
</g>
<!-- NodeImpl_handle_election_timeout&#45;&gt;NodeImpl_reset_leader_id -->
<g id="edge2" class="edge">
<title>NodeImpl_handle_election_timeout&#45;&gt;NodeImpl_reset_leader_id</title>
<path fill="none" stroke="black" d="M1452,-1733.22C1452,-1723.43 1452,-1710.96 1452,-1699.87"/>
<polygon fill="black" stroke="black" points="1455.5,-1699.8 1452,-1689.8 1448.5,-1699.8 1455.5,-1699.8"/>
<text text-anchor="middle" x="1454" y="-1709.23" font-family="Times,serif" font-size="7.00">1</text>
</g>
<!-- NodeImpl_prevote -->
<g id="node5" class="node">
<title>NodeImpl_prevote</title>
<ellipse fill="#555555" stroke="#555555" cx="1330" cy="-1671.53" rx="44.62" ry="18"/>
<text text-anchor="middle" x="1330" y="-1668.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::prevote</text>
</g>
<!-- NodeImpl_handle_election_timeout&#45;&gt;NodeImpl_prevote -->
<g id="edge3" class="edge">
<title>NodeImpl_handle_election_timeout&#45;&gt;NodeImpl_prevote</title>
<path fill="none" stroke="black" d="M1426.72,-1734.37C1407.75,-1722.24 1381.67,-1705.57 1361.37,-1692.59"/>
<polygon fill="black" stroke="black" points="1363.09,-1689.53 1352.78,-1687.1 1359.32,-1695.43 1363.09,-1689.53"/>
<text text-anchor="middle" x="1396.5" y="-1709.23" font-family="Times,serif" font-size="7.00">2</text>
</g>
<!-- NodeImpl_handle_transfer_timeout -->
<g id="node3" class="node">
<title>NodeImpl_handle_transfer_timeout</title>
<ellipse fill="#555555" stroke="#555555" cx="2628" cy="-331.38" rx="75.38" ry="18"/>
<text text-anchor="middle" x="2628" y="-328.68" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_transfer_timeout</text>
</g>
<!-- NodeImpl_elect_self -->
<g id="node7" class="node">
<title>NodeImpl_elect_self</title>
<ellipse fill="#555555" stroke="#555555" cx="1166" cy="-1591.53" rx="48.43" ry="18"/>
<text text-anchor="middle" x="1166" y="-1588.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::elect_self</text>
</g>
<!-- NodeImpl_prevote&#45;&gt;NodeImpl_elect_self -->
<g id="edge5" class="edge">
<title>NodeImpl_prevote&#45;&gt;NodeImpl_elect_self</title>
<path fill="none" stroke="black" d="M1302.18,-1657.3C1275.13,-1644.44 1233.85,-1624.8 1203.83,-1610.53"/>
<polygon fill="black" stroke="black" points="1205.04,-1607.23 1194.51,-1606.09 1202.04,-1613.55 1205.04,-1607.23"/>
<text text-anchor="middle" x="1276.5" y="-1629.23" font-family="Times,serif" font-size="7.00">quorum granted</text>
</g>
<!-- NodeImpl_handle_request_prevote_response -->
<g id="node9" class="node">
<title>NodeImpl_handle_request_prevote_response</title>
<ellipse fill="#555555" stroke="#555555" cx="1330" cy="-1591.53" rx="93.05" ry="18"/>
<text text-anchor="middle" x="1330" y="-1588.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_request_prevote_response</text>
</g>
<!-- NodeImpl_prevote&#45;&gt;NodeImpl_handle_request_prevote_response -->
<g id="edge4" class="edge">
<title>NodeImpl_prevote&#45;&gt;NodeImpl_handle_request_prevote_response</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1330,-1653.22C1330,-1643.43 1330,-1630.96 1330,-1619.87"/>
<polygon fill="black" stroke="black" points="1333.5,-1619.8 1330,-1609.8 1326.5,-1619.8 1333.5,-1619.8"/>
<text text-anchor="middle" x="1350.5" y="-1629.23" font-family="Times,serif" font-size="7.00">run in bthread</text>
</g>
<!-- stop_election_timer -->
<g id="node6" class="node">
<title>stop_election_timer</title>
<ellipse fill="#555555" stroke="#555555" cx="1269" cy="-1511.53" rx="49.83" ry="18"/>
<text text-anchor="middle" x="1269" y="-1508.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">_election_timer.stop()</text>
</g>
<!-- NodeImpl_elect_self&#45;&gt;stop_election_timer -->
<g id="edge7" class="edge">
<title>NodeImpl_elect_self&#45;&gt;stop_election_timer</title>
<path fill="none" stroke="black" d="M1186.35,-1575.12C1201.77,-1563.45 1223.15,-1547.26 1240.3,-1534.27"/>
<polygon fill="black" stroke="black" points="1242.48,-1537.01 1248.34,-1528.18 1238.26,-1531.43 1242.48,-1537.01"/>
<text text-anchor="middle" x="1233.5" y="-1549.23" font-family="Times,serif" font-size="7.00">follower</text>
</g>
<!-- NodeImpl_vote -->
<g id="node8" class="node">
<title>NodeImpl_vote</title>
<ellipse fill="#555555" stroke="#555555" cx="1162" cy="-1511.53" rx="39.28" ry="18"/>
<text text-anchor="middle" x="1162" y="-1508.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::vote</text>
</g>
<!-- NodeImpl_elect_self&#45;&gt;NodeImpl_vote -->
<g id="edge6" class="edge">
<title>NodeImpl_elect_self&#45;&gt;NodeImpl_vote</title>
<path fill="none" stroke="black" d="M1165.11,-1573.22C1164.61,-1563.43 1163.97,-1550.96 1163.4,-1539.87"/>
<polygon fill="black" stroke="black" points="1166.89,-1539.6 1162.89,-1529.8 1159.9,-1539.96 1166.89,-1539.6"/>
</g>
<!-- NodeImpl_handle_request_vote_response -->
<g id="node10" class="node">
<title>NodeImpl_handle_request_vote_response</title>
<ellipse fill="#555555" stroke="#555555" cx="1087" cy="-1424.79" rx="87.21" ry="18"/>
<text text-anchor="middle" x="1087" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_request_vote_response</text>
</g>
<!-- NodeImpl_vote&#45;&gt;NodeImpl_handle_request_vote_response -->
<g id="edge8" class="edge">
<title>NodeImpl_vote&#45;&gt;NodeImpl_handle_request_vote_response</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1147.89,-1494.59C1136.87,-1482.13 1121.35,-1464.59 1108.73,-1450.34"/>
<polygon fill="black" stroke="black" points="1111.32,-1447.99 1102.07,-1442.82 1106.08,-1452.63 1111.32,-1447.99"/>
<text text-anchor="middle" x="1149.5" y="-1469.23" font-family="Times,serif" font-size="7.00">run in bthread</text>
</g>
<!-- NodeImpl_become_leader -->
<g id="node11" class="node">
<title>NodeImpl_become_leader</title>
<ellipse fill="#555555" stroke="#555555" cx="1251" cy="-1424.79" rx="58.98" ry="18"/>
<text text-anchor="middle" x="1251" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::become_leader</text>
</g>
<!-- NodeImpl_vote&#45;&gt;NodeImpl_become_leader -->
<g id="edge9" class="edge">
<title>NodeImpl_vote&#45;&gt;NodeImpl_become_leader</title>
<path fill="none" stroke="black" d="M1178.32,-1494.99C1191.74,-1482.21 1210.97,-1463.91 1226.27,-1449.33"/>
<polygon fill="black" stroke="black" points="1229.04,-1451.53 1233.87,-1442.1 1224.21,-1446.46 1229.04,-1451.53"/>
<text text-anchor="middle" x="1230.5" y="-1469.23" font-family="Times,serif" font-size="7.00">quorum granted</text>
</g>
<!-- NodeImpl_ConfigurationCtx_flush -->
<g id="node12" class="node">
<title>NodeImpl_ConfigurationCtx_flush</title>
<ellipse fill="#555555" stroke="#555555" cx="1251" cy="-1338.04" rx="74.75" ry="18"/>
<text text-anchor="middle" x="1251" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::ConfigurationCtx::flush</text>
</g>
<!-- NodeImpl_become_leader&#45;&gt;NodeImpl_ConfigurationCtx_flush -->
<g id="edge10" class="edge">
<title>NodeImpl_become_leader&#45;&gt;NodeImpl_ConfigurationCtx_flush</title>
<path fill="none" stroke="red" d="M1251,-1406.64C1251,-1395.03 1251,-1379.46 1251,-1366.19"/>
<polygon fill="red" stroke="red" points="1254.5,-1366.16 1251,-1356.16 1247.5,-1366.16 1254.5,-1366.16"/>
<text text-anchor="middle" x="1294" y="-1375.74" font-family="Times,serif" font-size="7.00" fill="red">write a config log to all nodes</text>
</g>
<!-- NodeImpl_unsafe_apply_configuration -->
<g id="node13" class="node">
<title>NodeImpl_unsafe_apply_configuration</title>
<ellipse fill="#555555" stroke="#555555" cx="1251" cy="-1251.29" rx="82.5" ry="18"/>
<text text-anchor="middle" x="1251" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::unsafe_apply_configuration</text>
</g>
<!-- NodeImpl_ConfigurationCtx_flush&#45;&gt;NodeImpl_unsafe_apply_configuration -->
<g id="edge11" class="edge">
<title>NodeImpl_ConfigurationCtx_flush&#45;&gt;NodeImpl_unsafe_apply_configuration</title>
<path fill="none" stroke="black" d="M1251,-1319.89C1251,-1308.28 1251,-1292.72 1251,-1279.44"/>
<polygon fill="black" stroke="black" points="1254.5,-1279.41 1251,-1269.41 1247.5,-1279.41 1254.5,-1279.41"/>
</g>
<!-- LogManager_append_entries -->
<g id="node40" class="node">
<title>LogManager_append_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="1061" cy="-1156.15" rx="63.56" ry="18"/>
<text text-anchor="middle" x="1061" y="-1153.45" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::append_entries</text>
</g>
<!-- NodeImpl_unsafe_apply_configuration&#45;&gt;LogManager_append_entries -->
<g id="edge16" class="edge">
<title>NodeImpl_unsafe_apply_configuration&#45;&gt;LogManager_append_entries</title>
<path fill="none" stroke="black" d="M1218.77,-1234.49C1186.11,-1218.48 1135.55,-1193.7 1100.5,-1176.52"/>
<polygon fill="black" stroke="black" points="1102.02,-1173.36 1091.5,-1172.1 1098.94,-1179.65 1102.02,-1173.36"/>
<text text-anchor="middle" x="1196" y="-1198.24" font-family="Times,serif" font-size="7.00">2. LeaderStableClosure</text>
</g>
<!-- BallotBox_append_pending_task -->
<g id="node46" class="node">
<title>BallotBox_append_pending_task</title>
<ellipse fill="#555555" stroke="#555555" cx="1437" cy="-1156.15" rx="71.44" ry="18"/>
<text text-anchor="middle" x="1437" y="-1153.45" font-family="Times,serif" font-size="8.00" fill="#ffffff">BallotBox::append_pending_task</text>
</g>
<!-- NodeImpl_unsafe_apply_configuration&#45;&gt;BallotBox_append_pending_task -->
<g id="edge12" class="edge">
<title>NodeImpl_unsafe_apply_configuration&#45;&gt;BallotBox_append_pending_task</title>
<path fill="none" stroke="black" d="M1263.2,-1233.47C1273.48,-1220.47 1289.32,-1202.98 1307,-1192.54 1318.84,-1185.55 1347.22,-1177.52 1374.45,-1170.87"/>
<polygon fill="black" stroke="black" points="1375.49,-1174.22 1384.4,-1168.49 1373.86,-1167.42 1375.49,-1174.22"/>
<text text-anchor="middle" x="1349" y="-1198.24" font-family="Times,serif" font-size="7.00">1. ConfigurationChangeDone</text>
</g>
<!-- LogManager_check_and_set_configuration -->
<g id="node51" class="node">
<title>LogManager_check_and_set_configuration</title>
<ellipse fill="#555555" stroke="#555555" cx="1253" cy="-1156.15" rx="90.38" ry="18"/>
<text text-anchor="middle" x="1253" y="-1153.45" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::check_and_set_configuration</text>
</g>
<!-- NodeImpl_unsafe_apply_configuration&#45;&gt;LogManager_check_and_set_configuration -->
<g id="edge17" class="edge">
<title>NodeImpl_unsafe_apply_configuration&#45;&gt;LogManager_check_and_set_configuration</title>
<path fill="none" stroke="black" d="M1251.37,-1233.21C1251.66,-1219.64 1252.07,-1200.4 1252.41,-1184.66"/>
<polygon fill="black" stroke="black" points="1255.91,-1184.52 1252.63,-1174.44 1248.91,-1184.37 1255.91,-1184.52"/>
<text text-anchor="middle" x="1255" y="-1198.24" font-family="Times,serif" font-size="7.00">3</text>
</g>
<!-- NodeImpl_transfer_leadership_to -->
<g id="node14" class="node">
<title>NodeImpl_transfer_leadership_to</title>
<ellipse fill="#555555" stroke="#555555" cx="2452" cy="-515.77" rx="72.08" ry="18"/>
<text text-anchor="middle" x="2452" y="-513.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::transfer_leadership_to</text>
</g>
<!-- ReplicatorGroup_transfer_leadership_to -->
<g id="node34" class="node">
<title>ReplicatorGroup_transfer_leadership_to</title>
<ellipse fill="#555555" stroke="#555555" cx="2452" cy="-419.77" rx="83.9" ry="18"/>
<text text-anchor="middle" x="2452" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">ReplicatorGroup::transfer_leadership_to</text>
</g>
<!-- NodeImpl_transfer_leadership_to&#45;&gt;ReplicatorGroup_transfer_leadership_to -->
<g id="edge88" class="edge">
<title>NodeImpl_transfer_leadership_to&#45;&gt;ReplicatorGroup_transfer_leadership_to</title>
<path fill="none" stroke="blue" d="M2452,-497.53C2452,-483.75 2452,-464.17 2452,-448.23"/>
<polygon fill="blue" stroke="blue" points="2455.5,-447.9 2452,-437.9 2448.5,-447.9 2455.5,-447.9"/>
<text text-anchor="middle" x="2481" y="-465.47" font-family="Times,serif" font-size="7.00">1. if conf is not busy</text>
</g>
<!-- FSMCaller_on_leader_stop -->
<g id="node87" class="node">
<title>FSMCaller_on_leader_stop</title>
<ellipse fill="#555555" stroke="#555555" cx="2253" cy="-419.77" rx="60.25" ry="18"/>
<text text-anchor="middle" x="2253" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_leader_stop</text>
</g>
<!-- NodeImpl_transfer_leadership_to&#45;&gt;FSMCaller_on_leader_stop -->
<g id="edge93" class="edge">
<title>NodeImpl_transfer_leadership_to&#45;&gt;FSMCaller_on_leader_stop</title>
<path fill="none" stroke="blue" d="M2412.57,-500.66C2396.67,-494.66 2378.28,-487.3 2362,-479.77 2336.65,-468.04 2308.99,-453.04 2287.87,-441.1"/>
<polygon fill="blue" stroke="blue" points="2289.38,-437.93 2278.96,-436.02 2285.92,-444.01 2289.38,-437.93"/>
<text text-anchor="middle" x="2405" y="-469.47" font-family="Times,serif" font-size="7.00" fill="red">2. notify user app leader stops</text>
<text text-anchor="middle" x="2405" y="-461.47" font-family="Times,serif" font-size="7.00" fill="red">if timeout_now sent</text>
</g>
<!-- bthread_timer_add -->
<g id="node126" class="node">
<title>bthread_timer_add</title>
<ellipse fill="#555555" stroke="#555555" cx="2613" cy="-419.77" rx="44.62" ry="18"/>
<text text-anchor="middle" x="2613" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">bthread_timer_add</text>
</g>
<!-- NodeImpl_transfer_leadership_to&#45;&gt;bthread_timer_add -->
<g id="edge95" class="edge">
<title>NodeImpl_transfer_leadership_to&#45;&gt;bthread_timer_add</title>
<path fill="none" stroke="blue" d="M2480.17,-499.05C2490.8,-493.07 2502.99,-486.16 2514,-479.77 2536.26,-466.85 2561.15,-452.02 2580.4,-440.46"/>
<polygon fill="blue" stroke="blue" points="2582.32,-443.39 2589.09,-435.23 2578.71,-437.39 2582.32,-443.39"/>
<text text-anchor="middle" x="2594.5" y="-469.47" font-family="Times,serif" font-size="7.00">3. start transfer_timeout timer</text>
<text text-anchor="middle" x="2594.5" y="-461.47" font-family="Times,serif" font-size="7.00">wait for prevote</text>
</g>
<!-- NodeImpl_init -->
<g id="node15" class="node">
<title>NodeImpl_init</title>
<ellipse fill="#555555" stroke="#555555" cx="1386" cy="-2039.49" rx="36.74" ry="18"/>
<text text-anchor="middle" x="1386" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::init</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_elect_self -->
<g id="edge108" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_elect_self</title>
<path fill="none" stroke="black" d="M1348.94,-2039.04C1236.66,-2040.05 902.57,-2037.78 816,-1977.49 801,-1967.04 797,-1959.29 797,-1941.01 797,-1941.01 797,-1941.01 797,-1670.53 797,-1638.92 1006.99,-1610.62 1110.15,-1598.62"/>
<polygon fill="black" stroke="black" points="1110.85,-1602.06 1120.38,-1597.44 1110.05,-1595.11 1110.85,-1602.06"/>
<text text-anchor="middle" x="850" y="-1805.23" font-family="Times,serif" font-size="7.00">9. _conf.stable()</text>
<text text-anchor="middle" x="850" y="-1797.23" font-family="Times,serif" font-size="7.00">&amp;&amp; _conf.conf.size() == 1u</text>
<text text-anchor="middle" x="850" y="-1789.23" font-family="Times,serif" font-size="7.00">&amp;&amp; _conf.conf.contains(_server_id))</text>
</g>
<!-- NodeImpl_init_log_storage -->
<g id="node17" class="node">
<title>NodeImpl_init_log_storage</title>
<ellipse fill="#555555" stroke="#555555" cx="886" cy="-1940.01" rx="60.89" ry="18"/>
<text text-anchor="middle" x="886" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::init_log_storage</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_init_log_storage -->
<g id="edge101" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_init_log_storage</title>
<path fill="none" stroke="black" d="M1349.11,-2037.44C1273.56,-2034.39 1096.53,-2022.6 956,-1977.49 943.67,-1973.53 930.9,-1967.52 919.69,-1961.51"/>
<polygon fill="black" stroke="black" points="921.14,-1958.31 910.7,-1956.52 917.74,-1964.43 921.14,-1958.31"/>
<text text-anchor="middle" x="1050.5" y="-1997.19" font-family="Times,serif" font-size="7.00">2</text>
</g>
<!-- NodeImpl_init_stable_storage -->
<g id="node18" class="node">
<title>NodeImpl_init_stable_storage</title>
<ellipse fill="#555555" stroke="#555555" cx="1030" cy="-1940.01" rx="65.46" ry="18"/>
<text text-anchor="middle" x="1030" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::init_stable_storage</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_init_stable_storage -->
<g id="edge102" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_init_stable_storage</title>
<path fill="none" stroke="black" d="M1351.1,-2033.66C1297.24,-2025.6 1191.09,-2007.29 1105,-1977.49 1092.26,-1973.08 1078.87,-1967.05 1066.98,-1961.17"/>
<polygon fill="black" stroke="black" points="1068.31,-1957.92 1057.81,-1956.51 1065.14,-1964.16 1068.31,-1957.92"/>
<text text-anchor="middle" x="1191" y="-1997.19" font-family="Times,serif" font-size="7.00">3</text>
</g>
<!-- NodeImpl_init_fsm_caller -->
<g id="node19" class="node">
<title>NodeImpl_init_fsm_caller</title>
<ellipse fill="#555555" stroke="#555555" cx="1172" cy="-1940.01" rx="58.35" ry="18"/>
<text text-anchor="middle" x="1172" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl_init::fsm_caller</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_init_fsm_caller -->
<g id="edge103" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_init_fsm_caller</title>
<path fill="none" stroke="black" d="M1357.71,-2027.77C1327.82,-2016.21 1279.51,-1996.85 1239,-1977.49 1228.57,-1972.5 1217.47,-1966.68 1207.36,-1961.16"/>
<polygon fill="black" stroke="black" points="1208.85,-1957.99 1198.4,-1956.22 1205.46,-1964.12 1208.85,-1957.99"/>
<text text-anchor="middle" x="1296.5" y="-1997.19" font-family="Times,serif" font-size="7.00">4</text>
</g>
<!-- NodeImpl_init_snapshot_storage -->
<g id="node20" class="node">
<title>NodeImpl_init_snapshot_storage</title>
<ellipse fill="#555555" stroke="#555555" cx="1319" cy="-1940.01" rx="70.81" ry="18"/>
<text text-anchor="middle" x="1319" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::init_snapshot_storage</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_init_snapshot_storage -->
<g id="edge104" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_init_snapshot_storage</title>
<path fill="none" stroke="black" d="M1374.63,-2021.95C1364.21,-2006.78 1348.6,-1984.07 1336.57,-1966.57"/>
<polygon fill="black" stroke="black" points="1339.2,-1964.21 1330.65,-1957.96 1333.43,-1968.18 1339.2,-1964.21"/>
<text text-anchor="middle" x="1362" y="-1997.19" font-family="Times,serif" font-size="7.00">5</text>
</g>
<!-- NodeManager_add -->
<g id="node31" class="node">
<title>NodeManager_add</title>
<ellipse fill="#aa5555" stroke="#aa5555" cx="1784" cy="-1940.01" rx="45.26" ry="18"/>
<text text-anchor="middle" x="1784" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeManager::add</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeManager_add -->
<g id="edge107" class="edge">
<title>NodeImpl_init&#45;&gt;NodeManager_add</title>
<path fill="none" stroke="black" d="M1422.62,-2037.22C1487.13,-2033.87 1624.22,-2021.68 1730,-1977.49 1739.3,-1973.6 1748.66,-1968.01 1756.92,-1962.36"/>
<polygon fill="black" stroke="black" points="1758.98,-1965.19 1765.08,-1956.53 1754.91,-1959.5 1758.98,-1965.19"/>
<text text-anchor="middle" x="1723.5" y="-1997.19" font-family="Times,serif" font-size="7.00">8. add to singleton NodeManager</text>
</g>
<!-- ReplicatorGroup_init -->
<g id="node35" class="node">
<title>ReplicatorGroup_init</title>
<ellipse fill="#555555" stroke="#555555" cx="1580" cy="-1940.01" rx="49.2" ry="18"/>
<text text-anchor="middle" x="1580" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">ReplicatorGroup::init</text>
</g>
<!-- NodeImpl_init&#45;&gt;ReplicatorGroup_init -->
<g id="edge106" class="edge">
<title>NodeImpl_init&#45;&gt;ReplicatorGroup_init</title>
<path fill="none" stroke="black" d="M1413.39,-2027.34C1441.02,-2015.81 1484.67,-1996.82 1521,-1977.49 1530.17,-1972.61 1539.86,-1966.88 1548.67,-1961.42"/>
<polygon fill="black" stroke="black" points="1550.54,-1964.38 1557.15,-1956.1 1546.82,-1958.45 1550.54,-1964.38"/>
<text text-anchor="middle" x="1486" y="-1997.19" font-family="Times,serif" font-size="7.00">7</text>
</g>
<!-- BallotBox_init -->
<g id="node45" class="node">
<title>BallotBox_init</title>
<ellipse fill="#555555" stroke="#555555" cx="1684" cy="-1940.01" rx="36.74" ry="18"/>
<text text-anchor="middle" x="1684" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">BallotBox::init</text>
</g>
<!-- NodeImpl_init&#45;&gt;BallotBox_init -->
<g id="edge105" class="edge">
<title>NodeImpl_init&#45;&gt;BallotBox_init</title>
<path fill="none" stroke="black" d="M1421.87,-2034.74C1472.29,-2028.39 1565.99,-2012.62 1638,-1977.49 1645.73,-1973.72 1653.36,-1968.47 1660.12,-1963.13"/>
<polygon fill="black" stroke="black" points="1662.72,-1965.51 1668.15,-1956.42 1658.23,-1960.14 1662.72,-1965.51"/>
<text text-anchor="middle" x="1594" y="-1997.19" font-family="Times,serif" font-size="7.00">6</text>
</g>
<!-- bthread_execution_queue_start_apply_queue -->
<g id="node62" class="node">
<title>bthread_execution_queue_start_apply_queue</title>
<ellipse fill="#555555" stroke="#555555" cx="1771" cy="-1424.79" rx="86.03" ry="25"/>
<text text-anchor="middle" x="1771" y="-1431.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">bthread::execution_queue_start(</text>
<text text-anchor="middle" x="1771" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">_apply_queue_id,</text>
<text text-anchor="middle" x="1771" y="-1413.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">execute_applying_tasks)</text>
</g>
<!-- NodeImpl_init&#45;&gt;bthread_execution_queue_start_apply_queue -->
<g id="edge99" class="edge">
<title>NodeImpl_init&#45;&gt;bthread_execution_queue_start_apply_queue</title>
<path fill="none" stroke="black" d="M1423.07,-2038.83C1492.97,-2038.68 1648.56,-2034.51 1775,-2003.49 1819.5,-1992.57 1857,-1986.83 1857,-1941.01 1857,-1941.01 1857,-1941.01 1857,-1510.53 1857,-1486.32 1839.49,-1466.71 1820.28,-1452.47"/>
<polygon fill="black" stroke="black" points="1822.19,-1449.54 1811.99,-1446.7 1818.19,-1455.28 1822.19,-1449.54"/>
<text text-anchor="middle" x="1859" y="-1709.23" font-family="Times,serif" font-size="7.00">1</text>
</g>
<!-- NodeImpl_init_timers -->
<g id="node127" class="node">
<title>NodeImpl_init_timers</title>
<ellipse fill="#555555" stroke="#555555" cx="1460" cy="-1940.01" rx="52.15" ry="37.45"/>
<text text-anchor="middle" x="1460" y="-1955.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">Init</text>
<text text-anchor="middle" x="1460" y="-1946.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">_vote_timer</text>
<text text-anchor="middle" x="1460" y="-1937.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">_election_timer</text>
<text text-anchor="middle" x="1460" y="-1928.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">_stepdown_timer</text>
<text text-anchor="middle" x="1460" y="-1919.31" font-family="Times,serif" font-size="8.00" fill="#ffffff">_snapshot_timer</text>
</g>
<!-- NodeImpl_init&#45;&gt;NodeImpl_init_timers -->
<g id="edge97" class="edge">
<title>NodeImpl_init&#45;&gt;NodeImpl_init_timers</title>
<path fill="none" stroke="black" d="M1398.22,-2022.39C1406.66,-2011.27 1418.29,-1995.96 1429.18,-1981.61"/>
<polygon fill="black" stroke="black" points="1432.22,-1983.39 1435.48,-1973.31 1426.64,-1979.16 1432.22,-1983.39"/>
<text text-anchor="middle" x="1420" y="-1997.19" font-family="Times,serif" font-size="7.00">0</text>
</g>
<!-- NodeImpl_execute_applying_tasks -->
<g id="node16" class="node">
<title>NodeImpl_execute_applying_tasks</title>
<ellipse fill="#555555" stroke="#555555" cx="1443" cy="-1338.04" rx="74.75" ry="18"/>
<text text-anchor="middle" x="1443" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::execute_applying_tasks</text>
</g>
<!-- NodeImpl_apply_LogEntryAndClosure_size_t -->
<g id="node29" class="node">
<title>NodeImpl_apply_LogEntryAndClosure_size_t</title>
<ellipse fill="#555555" stroke="#555555" cx="1440" cy="-1251.29" rx="84.29" ry="25"/>
<text text-anchor="middle" x="1440" y="-1257.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::apply</text>
<text text-anchor="middle" x="1440" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">(LogEntryAndClosure[], size_t)</text>
<text text-anchor="middle" x="1440" y="-1239.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">lock guarded</text>
</g>
<!-- NodeImpl_execute_applying_tasks&#45;&gt;NodeImpl_apply_LogEntryAndClosure_size_t -->
<g id="edge132" class="edge">
<title>NodeImpl_execute_applying_tasks&#45;&gt;NodeImpl_apply_LogEntryAndClosure_size_t</title>
<path fill="none" stroke="black" d="M1442.39,-1319.89C1442.05,-1310.26 1441.61,-1297.9 1441.21,-1286.39"/>
<polygon fill="black" stroke="black" points="1444.7,-1286.03 1440.84,-1276.16 1437.7,-1286.27 1444.7,-1286.03"/>
</g>
<!-- LogManager_LogManager -->
<g id="node63" class="node">
<title>LogManager_LogManager</title>
<ellipse fill="#555555" stroke="#555555" cx="916" cy="-1847.53" rx="59.62" ry="18"/>
<text text-anchor="middle" x="916" y="-1844.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::LogManager</text>
</g>
<!-- NodeImpl_init_log_storage&#45;&gt;LogManager_LogManager -->
<g id="edge110" class="edge">
<title>NodeImpl_init_log_storage&#45;&gt;LogManager_LogManager</title>
<path fill="none" stroke="black" d="M891.64,-1921.99C896,-1908.85 902.11,-1890.42 907.12,-1875.3"/>
<polygon fill="black" stroke="black" points="910.56,-1876.07 910.38,-1865.48 903.91,-1873.87 910.56,-1876.07"/>
</g>
<!-- NodeImpl_handle_prevote_request -->
<g id="node21" class="node">
<title>NodeImpl_handle_prevote_request</title>
<ellipse fill="#555555" stroke="#555555" cx="91" cy="-1251.29" rx="74.75" ry="18"/>
<text text-anchor="middle" x="91" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_prevote_request</text>
</g>
<!-- NodeImpl_handle_request_vote_request -->
<g id="node22" class="node">
<title>NodeImpl_handle_request_vote_request</title>
<ellipse fill="#555555" stroke="#555555" cx="268" cy="-1251.29" rx="84.53" ry="18"/>
<text text-anchor="middle" x="268" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_request_vote_request</text>
</g>
<!-- NodeImpl_handle_append_entries_request -->
<g id="node23" class="node">
<title>NodeImpl_handle_append_entries_request</title>
<ellipse fill="#555555" stroke="#555555" cx="460" cy="-1251.29" rx="89.11" ry="18"/>
<text text-anchor="middle" x="460" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_append_entries_request</text>
</g>
<!-- NodeImpl_check_step_down -->
<g id="node26" class="node">
<title>NodeImpl_check_step_down</title>
<ellipse fill="#555555" stroke="#555555" cx="351" cy="-1156.15" rx="64.19" ry="18"/>
<text text-anchor="middle" x="351" y="-1153.45" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::check_step_down</text>
</g>
<!-- NodeImpl_handle_append_entries_request&#45;&gt;NodeImpl_check_step_down -->
<g id="edge126" class="edge">
<title>NodeImpl_handle_append_entries_request&#45;&gt;NodeImpl_check_step_down</title>
<path fill="none" stroke="black" d="M440.51,-1233.64C423.08,-1218.74 397.34,-1196.75 377.94,-1180.17"/>
<polygon fill="black" stroke="black" points="380.19,-1177.5 370.32,-1173.66 375.65,-1182.82 380.19,-1177.5"/>
<text text-anchor="middle" x="411" y="-1198.24" font-family="Times,serif" font-size="7.00">1</text>
</g>
<!-- NodeImpl_handle_append_entries_request&#45;&gt;LogManager_append_entries -->
<g id="edge129" class="edge">
<title>NodeImpl_handle_append_entries_request&#45;&gt;LogManager_append_entries</title>
<path fill="none" stroke="black" d="M510.11,-1236.32C525.4,-1232.38 542.32,-1228.34 558,-1225.29 711.72,-1195.37 894.41,-1174.16 991.78,-1163.98"/>
<polygon fill="black" stroke="black" points="992.2,-1167.45 1001.79,-1162.94 991.48,-1160.49 992.2,-1167.45"/>
<text text-anchor="middle" x="767" y="-1198.24" font-family="Times,serif" font-size="7.00" fill="red">3. follower</text>
</g>
<!-- Ballot_set_last_committed_index -->
<g id="node44" class="node">
<title>Ballot_set_last_committed_index</title>
<ellipse fill="#555555" stroke="#555555" cx="505" cy="-1156.15" rx="71.44" ry="18"/>
<text text-anchor="middle" x="505" y="-1153.45" font-family="Times,serif" font-size="8.00" fill="#ffffff">Ballot::set_last_committed_index</text>
</g>
<!-- NodeImpl_handle_append_entries_request&#45;&gt;Ballot_set_last_committed_index -->
<g id="edge128" class="edge">
<title>NodeImpl_handle_append_entries_request&#45;&gt;Ballot_set_last_committed_index</title>
<path fill="none" stroke="black" d="M468.25,-1233.21C474.98,-1219.29 484.59,-1199.41 492.29,-1183.46"/>
<polygon fill="black" stroke="black" points="495.6,-1184.65 496.8,-1174.13 489.3,-1181.61 495.6,-1184.65"/>
<text text-anchor="middle" x="532" y="-1202.24" font-family="Times,serif" font-size="7.00">2. request&#45;&gt;entries_size() == 0</text>
<text text-anchor="middle" x="532" y="-1194.24" font-family="Times,serif" font-size="7.00">empty log entry as heartbeat</text>
</g>
<!-- NodeImpl_handle_install_snapshot_request -->
<g id="node24" class="node">
<title>NodeImpl_handle_install_snapshot_request</title>
<ellipse fill="#555555" stroke="#555555" cx="657" cy="-1251.29" rx="90.38" ry="18"/>
<text text-anchor="middle" x="657" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_install_snapshot_request</text>
</g>
<!-- NodeImpl_handle_timeout_now_request -->
<g id="node25" class="node">
<title>NodeImpl_handle_timeout_now_request</title>
<ellipse fill="#555555" stroke="#555555" cx="850" cy="-1251.29" rx="85.17" ry="18"/>
<text text-anchor="middle" x="850" y="-1248.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::handle_timeout_now_request</text>
</g>
<!-- NodeImpl_step_down -->
<g id="node27" class="node">
<title>NodeImpl_step_down</title>
<ellipse fill="#555555" stroke="#555555" cx="351" cy="-1043.77" rx="51.1" ry="18"/>
<text text-anchor="middle" x="351" y="-1041.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::step_down</text>
</g>
<!-- NodeImpl_check_step_down&#45;&gt;NodeImpl_step_down -->
<g id="edge127" class="edge">
<title>NodeImpl_check_step_down&#45;&gt;NodeImpl_step_down</title>
<path fill="none" stroke="black" d="M351,-1137.91C351,-1120.25 351,-1092.54 351,-1071.94"/>
<polygon fill="black" stroke="black" points="354.5,-1071.9 351,-1061.9 347.5,-1071.9 354.5,-1071.9"/>
<text text-anchor="middle" x="401.5" y="-1113.47" font-family="Times,serif" font-size="7.00">step down if</text>
<text text-anchor="middle" x="401.5" y="-1105.47" font-family="Times,serif" font-size="7.00">request_term &gt; _current_term</text>
<text text-anchor="middle" x="401.5" y="-1097.47" font-family="Times,serif" font-size="7.00">|| _state != STATE_FOLLOWER</text>
<text text-anchor="middle" x="401.5" y="-1089.47" font-family="Times,serif" font-size="7.00">|| _leader_id.is_empty() // no leader</text>
<text text-anchor="middle" x="401.5" y="-1081.47" font-family="Times,serif" font-size="7.00">||leader not match</text>
</g>
<!-- NodeImpl_apply_Task -->
<g id="node28" class="node">
<title>NodeImpl_apply_Task</title>
<ellipse fill="#555555" stroke="#555555" cx="1443" cy="-1511.53" rx="52.51" ry="18"/>
<text text-anchor="middle" x="1443" y="-1508.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::apply(Task)</text>
</g>
<!-- bthread queue\n_apply_queue&#45;&gt;execute -->
<g id="node129" class="node">
<title>bthread queue\n_apply_queue&#45;&gt;execute</title>
<ellipse fill="#555555" stroke="#555555" cx="1443" cy="-1424.79" rx="67.35" ry="18.27"/>
<text text-anchor="middle" x="1443" y="-1426.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">bthread queue</text>
<text text-anchor="middle" x="1443" y="-1417.59" font-family="Times,serif" font-size="8.00" fill="#ffffff">_apply_queue&#45;&gt;execute</text>
</g>
<!-- NodeImpl_apply_Task&#45;&gt;bthread queue\n_apply_queue&#45;&gt;execute -->
<g id="edge130" class="edge">
<title>NodeImpl_apply_Task&#45;&gt;bthread queue\n_apply_queue&#45;&gt;execute</title>
<path fill="none" stroke="black" d="M1443,-1493.38C1443,-1481.86 1443,-1466.42 1443,-1453.2"/>
<polygon fill="black" stroke="black" points="1446.5,-1453.2 1443,-1443.2 1439.5,-1453.2 1446.5,-1453.2"/>
</g>
<!-- NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;LogManager_append_entries -->
<g id="edge135" class="edge">
<title>NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;LogManager_append_entries</title>
<path fill="none" stroke="black" d="M1378.39,-1234.32C1336.43,-1223.38 1287.66,-1210.5 1283,-1208.54 1270.14,-1203.14 1269.08,-1197.39 1256,-1192.54 1212.83,-1176.55 1199.29,-1182.77 1154,-1174.54 1143.84,-1172.69 1133.05,-1170.7 1122.57,-1168.75"/>
<polygon fill="black" stroke="black" points="1123.11,-1165.29 1112.63,-1166.9 1121.82,-1172.18 1123.11,-1165.29"/>
<text text-anchor="middle" x="1285.5" y="-1198.24" font-family="Times,serif" font-size="7.00">2</text>
</g>
<!-- NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;BallotBox_append_pending_task -->
<g id="edge134" class="edge">
<title>NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;BallotBox_append_pending_task</title>
<path fill="none" stroke="black" d="M1439.23,-1226.3C1438.81,-1213.46 1438.3,-1197.59 1437.87,-1184.3"/>
<polygon fill="black" stroke="black" points="1441.37,-1184.18 1437.55,-1174.3 1434.38,-1184.4 1441.37,-1184.18"/>
<text text-anchor="middle" x="1467" y="-1202.24" font-family="Times,serif" font-size="7.00">1. for each log entry</text>
<text text-anchor="middle" x="1467" y="-1194.24" font-family="Times,serif" font-size="7.00">and closure</text>
</g>
<!-- NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;LogManager_check_and_set_configuration -->
<g id="edge136" class="edge">
<title>NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;LogManager_check_and_set_configuration</title>
<path fill="none" stroke="black" d="M1425.17,-1226.67C1416.56,-1214.78 1404.71,-1201.12 1391,-1192.54 1374.23,-1182.05 1354.47,-1174.66 1335.22,-1169.45"/>
<polygon fill="black" stroke="black" points="1336.08,-1166.06 1325.52,-1167 1334.36,-1172.85 1336.08,-1166.06"/>
<text text-anchor="middle" x="1411" y="-1198.24" font-family="Times,serif" font-size="7.00">3</text>
</g>
<!-- apply\nreturn EBUSY/EPERM -->
<g id="node130" class="node">
<title>apply\nreturn EBUSY/EPERM</title>
<ellipse fill="#555555" stroke="#555555" cx="1592" cy="-1156.15" rx="65.52" ry="18.27"/>
<text text-anchor="middle" x="1592" y="-1157.95" font-family="Times,serif" font-size="8.00" fill="#ffffff">apply</text>
<text text-anchor="middle" x="1592" y="-1148.95" font-family="Times,serif" font-size="8.00" fill="#ffffff">return EBUSY/EPERM</text>
</g>
<!-- NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;apply\nreturn EBUSY/EPERM -->
<g id="edge133" class="edge">
<title>NodeImpl_apply_LogEntryAndClosure_size_t&#45;&gt;apply\nreturn EBUSY/EPERM</title>
<path fill="none" stroke="black" d="M1475.25,-1228.69C1499.94,-1213.56 1532.76,-1193.45 1557.31,-1178.41"/>
<polygon fill="black" stroke="black" points="1559.26,-1181.32 1565.96,-1173.11 1555.6,-1175.35 1559.26,-1181.32"/>
<text text-anchor="middle" x="1555" y="-1198.24" font-family="Times,serif" font-size="7.00">0. if not leader</text>
</g>
<!-- NodeImpl_remove_peer -->
<g id="node30" class="node">
<title>NodeImpl_remove_peer</title>
<ellipse fill="#555555" stroke="#555555" cx="1900" cy="-2039.49" rx="55.04" ry="18"/>
<text text-anchor="middle" x="1900" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeImpl::remove_peer</text>
</g>
<!-- anno_NodeManager_add -->
<g id="node128" class="node">
<title>anno_NodeManager_add</title>
<polygon fill="#555555" stroke="#555555" points="1823,-1865.53 1723,-1865.53 1723,-1829.53 1829,-1829.53 1829,-1859.53 1823,-1865.53"/>
<polyline fill="none" stroke="#555555" points="1823,-1865.53 1823,-1859.53 "/>
<polyline fill="none" stroke="#555555" points="1829,-1859.53 1823,-1859.53 "/>
<text text-anchor="middle" x="1776" y="-1849.33" font-family="Times,serif" font-size="8.00" fill="#ffffff">all nodes are mananged</text>
<text text-anchor="middle" x="1776" y="-1840.33" font-family="Times,serif" font-size="8.00" fill="#ffffff">with a single NodeManager</text>
</g>
<!-- NodeManager_add&#45;&gt;anno_NodeManager_add -->
<g id="edge109" class="edge">
<title>NodeManager_add&#45;&gt;anno_NodeManager_add</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1782.5,-1921.99C1781.07,-1905.92 1778.95,-1881.93 1777.53,-1865.78"/>
</g>
<!-- NodeManager_add_service -->
<g id="node32" class="node">
<title>NodeManager_add_service</title>
<ellipse fill="#555555" stroke="#555555" cx="681" cy="-1511.53" rx="60.89" ry="18"/>
<text text-anchor="middle" x="681" y="-1508.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">NodeManager::add_service</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl -->
<g id="node75" class="node">
<title>RaftServiceImpl_RaftServiceImpl</title>
<ellipse fill="#555555" stroke="#555555" cx="460" cy="-1424.79" rx="72.71" ry="18"/>
<text text-anchor="middle" x="460" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::RaftServiceImpl</text>
</g>
<!-- NodeManager_add_service&#45;&gt;RaftServiceImpl_RaftServiceImpl -->
<g id="edge113" class="edge">
<title>NodeManager_add_service&#45;&gt;RaftServiceImpl_RaftServiceImpl</title>
<path fill="none" stroke="black" d="M640.43,-1498.08C620.56,-1491.74 596.37,-1483.67 575,-1475.53 550.56,-1466.23 523.72,-1454.7 502.11,-1445.08"/>
<polygon fill="black" stroke="black" points="503.45,-1441.84 492.89,-1440.95 500.59,-1448.23 503.45,-1441.84"/>
<text text-anchor="middle" x="608.5" y="-1469.23" font-family="Times,serif" font-size="7.00">2. add RaftServiceImpl</text>
</g>
<!-- RaftStatImpl_RaftStatImpl -->
<g id="node81" class="node">
<title>RaftStatImpl_RaftStatImpl</title>
<ellipse fill="#555555" stroke="#555555" cx="610" cy="-1424.79" rx="58.98" ry="18"/>
<text text-anchor="middle" x="610" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftStatImpl::RaftStatImpl</text>
</g>
<!-- NodeManager_add_service&#45;&gt;RaftStatImpl_RaftStatImpl -->
<g id="edge114" class="edge">
<title>NodeManager_add_service&#45;&gt;RaftStatImpl_RaftStatImpl</title>
<path fill="none" stroke="black" d="M666.97,-1493.79C656.57,-1481.37 642.22,-1464.24 630.53,-1450.29"/>
<polygon fill="black" stroke="black" points="633.1,-1447.91 624,-1442.49 627.74,-1452.41 633.1,-1447.91"/>
<text text-anchor="middle" x="678" y="-1469.23" font-family="Times,serif" font-size="7.00">3. add RaftStatImpl</text>
</g>
<!-- CliServiceImpl_CliServiceImpl -->
<g id="node82" class="node">
<title>CliServiceImpl_CliServiceImpl</title>
<ellipse fill="#555555" stroke="#555555" cx="754" cy="-1424.79" rx="66.87" ry="18"/>
<text text-anchor="middle" x="754" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">CliServiceImpl::CliServiceImpl</text>
</g>
<!-- NodeManager_add_service&#45;&gt;CliServiceImpl_CliServiceImpl -->
<g id="edge115" class="edge">
<title>NodeManager_add_service&#45;&gt;CliServiceImpl_CliServiceImpl</title>
<path fill="none" stroke="black" d="M695.42,-1493.79C706.12,-1481.37 720.87,-1464.24 732.9,-1450.29"/>
<polygon fill="black" stroke="black" points="735.73,-1452.36 739.61,-1442.49 730.43,-1447.79 735.73,-1452.36"/>
<text text-anchor="middle" x="750" y="-1469.23" font-family="Times,serif" font-size="7.00">4. add CliServiceImpl</text>
</g>
<!-- raft_file_service -->
<g id="node83" class="node">
<title>raft_file_service</title>
<ellipse fill="#555555" stroke="#555555" cx="879" cy="-1424.79" rx="39.91" ry="18"/>
<text text-anchor="middle" x="879" y="-1422.09" font-family="Times,serif" font-size="8.00" fill="#ffffff">raft::file_service</text>
</g>
<!-- NodeManager_add_service&#45;&gt;raft_file_service -->
<g id="edge112" class="edge">
<title>NodeManager_add_service&#45;&gt;raft_file_service</title>
<path fill="none" stroke="black" d="M722.75,-1498.41C742.25,-1492.29 765.61,-1484.31 786,-1475.53 806.91,-1466.53 829.45,-1454.54 847.1,-1444.59"/>
<polygon fill="black" stroke="black" points="848.89,-1447.59 855.85,-1439.59 845.43,-1441.51 848.89,-1447.59"/>
<text text-anchor="middle" x="827.5" y="-1469.23" font-family="Times,serif" font-size="7.00">1. add file service</text>
</g>
<!-- Node_transfer_leadership_to -->
<g id="node33" class="node">
<title>Node_transfer_leadership_to</title>
<ellipse fill="red" stroke="red" cx="2452" cy="-603.77" rx="62.92" ry="18"/>
<text text-anchor="middle" x="2452" y="-601.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Node::transfer_leadership_to</text>
</g>
<!-- Node_transfer_leadership_to&#45;&gt;NodeImpl_transfer_leadership_to -->
<g id="edge87" class="edge">
<title>Node_transfer_leadership_to&#45;&gt;NodeImpl_transfer_leadership_to</title>
<path fill="none" stroke="blue" d="M2452,-585.37C2452,-573.52 2452,-557.59 2452,-544.06"/>
<polygon fill="blue" stroke="blue" points="2455.5,-543.85 2452,-533.85 2448.5,-543.85 2455.5,-543.85"/>
</g>
<!-- Replicator_transfer_leadership -->
<g id="node36" class="node">
<title>Replicator_transfer_leadership</title>
<ellipse fill="#555555" stroke="#555555" cx="2452" cy="-331.38" rx="82.96" ry="18.27"/>
<text text-anchor="middle" x="2452" y="-333.18" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::transfer_leadership</text>
<text text-anchor="middle" x="2452" y="-324.18" font-family="Times,serif" font-size="8.00" fill="#ffffff">(replica_id, logindex)</text>
</g>
<!-- ReplicatorGroup_transfer_leadership_to&#45;&gt;Replicator_transfer_leadership -->
<g id="edge89" class="edge">
<title>ReplicatorGroup_transfer_leadership_to&#45;&gt;Replicator_transfer_leadership</title>
<path fill="none" stroke="blue" d="M2452,-401.7C2452,-389.91 2452,-373.95 2452,-360.32"/>
<polygon fill="blue" stroke="blue" points="2455.5,-360.01 2452,-350.01 2448.5,-360.01 2455.5,-360.01"/>
</g>
<!-- Replicator__transfer_leadership -->
<g id="node38" class="node">
<title>Replicator__transfer_leadership</title>
<ellipse fill="#555555" stroke="#555555" cx="2553" cy="-251" rx="90.38" ry="18"/>
<text text-anchor="middle" x="2553" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_transfer_leadership(log_index)</text>
</g>
<!-- Replicator_transfer_leadership&#45;&gt;Replicator__transfer_leadership -->
<g id="edge90" class="edge">
<title>Replicator_transfer_leadership&#45;&gt;Replicator__transfer_leadership</title>
<path fill="none" stroke="blue" d="M2473.92,-313.38C2488.44,-302.1 2507.67,-287.18 2523.53,-274.87"/>
<polygon fill="blue" stroke="blue" points="2525.72,-277.6 2531.47,-268.71 2521.43,-272.07 2525.72,-277.6"/>
</g>
<!-- Replicator__on_timeout_now_returned -->
<g id="node37" class="node">
<title>Replicator__on_timeout_now_returned</title>
<ellipse fill="#555555" stroke="#555555" cx="2613" cy="-91" rx="82.5" ry="18"/>
<text text-anchor="middle" x="2613" y="-88.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_on_timeout_now_returned</text>
</g>
<!-- Replicator__send_timeout_now -->
<g id="node39" class="node">
<title>Replicator__send_timeout_now</title>
<ellipse fill="#555555" stroke="#555555" cx="2613" cy="-171" rx="68.77" ry="18"/>
<text text-anchor="middle" x="2613" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_send_timeout_now</text>
</g>
<!-- Replicator__transfer_leadership&#45;&gt;Replicator__send_timeout_now -->
<g id="edge91" class="edge">
<title>Replicator__transfer_leadership&#45;&gt;Replicator__send_timeout_now</title>
<path fill="none" stroke="blue" d="M2566.02,-233.08C2574.12,-222.55 2584.68,-208.82 2593.73,-197.05"/>
<polygon fill="blue" stroke="blue" points="2596.68,-198.95 2600.01,-188.89 2591.13,-194.68 2596.68,-198.95"/>
<text text-anchor="middle" x="2589.5" y="-208.7" font-family="Times,serif" font-size="7.00">rpc</text>
</g>
<!-- Replicator__send_timeout_now&#45;&gt;Replicator__on_timeout_now_returned -->
<g id="edge92" class="edge">
<title>Replicator__send_timeout_now&#45;&gt;Replicator__on_timeout_now_returned</title>
<path fill="none" stroke="blue" d="M2613,-152.69C2613,-142.89 2613,-130.42 2613,-119.33"/>
<polygon fill="blue" stroke="blue" points="2616.5,-119.26 2613,-109.26 2609.5,-119.26 2616.5,-119.26"/>
</g>
<!-- LogManager_wakeup_all_waiter -->
<g id="node41" class="node">
<title>LogManager_wakeup_all_waiter</title>
<ellipse fill="#555555" stroke="#555555" cx="713" cy="-1043.77" rx="70.81" ry="18"/>
<text text-anchor="middle" x="713" y="-1041.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::wakeup_all_waiter</text>
</g>
<!-- LogManager_append_entries&#45;&gt;LogManager_wakeup_all_waiter -->
<g id="edge18" class="edge">
<title>LogManager_append_entries&#45;&gt;LogManager_wakeup_all_waiter</title>
<path fill="none" stroke="black" d="M1020.4,-1142.28C957.17,-1122.22 835.21,-1083.53 765.42,-1061.4"/>
<polygon fill="black" stroke="black" points="766.1,-1057.94 755.51,-1058.25 763.98,-1064.61 766.1,-1057.94"/>
<text text-anchor="middle" x="951.5" y="-1097.47" font-family="Times,serif" font-size="7.00">2</text>
</g>
<!-- LogManager_disk_thread -->
<g id="node58" class="node">
<title>LogManager_disk_thread</title>
<ellipse fill="#555555" stroke="#555555" cx="1011" cy="-1043.77" rx="57.08" ry="18"/>
<text text-anchor="middle" x="1011" y="-1041.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::disk_thread</text>
</g>
<!-- LogManager_append_entries&#45;&gt;LogManager_disk_thread -->
<g id="edge19" class="edge">
<title>LogManager_append_entries&#45;&gt;LogManager_disk_thread</title>
<path fill="none" stroke="black" d="M1053.19,-1137.91C1045.08,-1120 1032.29,-1091.78 1022.92,-1071.09"/>
<polygon fill="black" stroke="black" points="1026.07,-1069.56 1018.76,-1061.9 1019.7,-1072.45 1026.07,-1069.56"/>
<text text-anchor="middle" x="1098" y="-1101.47" font-family="Times,serif" font-size="7.00">1. bthread::execution_queue_execute</text>
<text text-anchor="middle" x="1098" y="-1093.47" font-family="Times,serif" font-size="7.00">entries inside of done</text>
</g>
<!-- LogManager_run_on_new_log -->
<g id="node52" class="node">
<title>LogManager_run_on_new_log</title>
<ellipse fill="#555555" stroke="#555555" cx="641" cy="-955.77" rx="66.87" ry="18"/>
<text text-anchor="middle" x="641" y="-953.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::run_on_new_log</text>
</g>
<!-- LogManager_wakeup_all_waiter&#45;&gt;LogManager_run_on_new_log -->
<g id="edge25" class="edge">
<title>LogManager_wakeup_all_waiter&#45;&gt;LogManager_run_on_new_log</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M668.3,-1029.8C657.97,-1024.63 648.19,-1017.51 642,-1007.77 637.64,-1000.91 636.28,-992.41 636.32,-984.34"/>
<polygon fill="red" stroke="red" points="639.83,-984.36 637.06,-974.13 632.85,-983.85 639.83,-984.36"/>
<text text-anchor="middle" x="706.5" y="-1001.47" font-family="Times,serif" font-size="7.00" fill="red">bthread_start_background</text>
<text text-anchor="middle" x="706.5" y="-993.47" font-family="Times,serif" font-size="7.00" fill="red">process all callbacks registered in _wait_map</text>
</g>
<!-- bthread_flush -->
<g id="node54" class="node">
<title>bthread_flush</title>
<ellipse fill="#555555" stroke="#555555" cx="785" cy="-955.77" rx="38.01" ry="18"/>
<text text-anchor="middle" x="785" y="-953.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">bthread_flush()</text>
</g>
<!-- LogManager_wakeup_all_waiter&#45;&gt;bthread_flush -->
<g id="edge27" class="edge">
<title>LogManager_wakeup_all_waiter&#45;&gt;bthread_flush</title>
<path fill="none" stroke="black" d="M747.38,-1027.82C756.15,-1022.58 764.83,-1015.93 771,-1007.77 776.22,-1000.87 779.49,-992.14 781.55,-983.87"/>
<polygon fill="black" stroke="black" points="785.03,-984.28 783.55,-973.79 778.17,-982.92 785.03,-984.28"/>
</g>
<!-- insert_wait_map -->
<g id="node56" class="node">
<title>insert_wait_map</title>
<ellipse fill="#555555" stroke="#555555" cx="494" cy="-331.38" rx="58.35" ry="18"/>
<text text-anchor="middle" x="494" y="-328.68" font-family="Times,serif" font-size="8.00" fill="#ffffff">_wait_map[wait_id] = wm</text>
</g>
<!-- LogManager_wakeup_all_waiter&#45;&gt;insert_wait_map -->
<g id="edge26" class="edge">
<title>LogManager_wakeup_all_waiter&#45;&gt;insert_wait_map</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M649.93,-1035.37C570.42,-1024.25 444,-999.79 444,-956.77 444,-956.77 444,-956.77 444,-418.77 444,-391.56 462.81,-365.24 477.35,-348.94"/>
<text text-anchor="middle" x="487.5" y="-689.47" font-family="Times,serif" font-size="7.00">traverse for notified WaitMeta</text>
</g>
<!-- LeaderStableClosure_Run -->
<g id="node42" class="node">
<title>LeaderStableClosure_Run</title>
<ellipse fill="#555555" stroke="#555555" cx="1018" cy="-779.77" rx="58.35" ry="18"/>
<text text-anchor="middle" x="1018" y="-777.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LeaderStableClosure::Run</text>
</g>
<!-- BallotBox_commit_at -->
<g id="node43" class="node">
<title>BallotBox_commit_at</title>
<ellipse fill="#555555" stroke="#555555" cx="857" cy="-515.77" rx="50.47" ry="18"/>
<text text-anchor="middle" x="857" y="-513.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">BallotBox::commit_at</text>
</g>
<!-- LeaderStableClosure_Run&#45;&gt;BallotBox_commit_at -->
<g id="edge20" class="edge">
<title>LeaderStableClosure_Run&#45;&gt;BallotBox_commit_at</title>
<path fill="none" stroke="black" d="M1012.34,-761.83C1007.76,-747.9 1001.22,-727.63 996,-709.77 995.36,-707.59 955.53,-553.44 954,-551.77 943.08,-539.86 927.81,-532 912.61,-526.81"/>
<polygon fill="black" stroke="black" points="913.26,-523.35 902.68,-523.77 911.21,-530.05 913.26,-523.35"/>
<text text-anchor="middle" x="1031" y="-645.47" font-family="Times,serif" font-size="7.00">leader accept the local log directly</text>
</g>
<!-- FSMCaller_on_committed -->
<g id="node85" class="node">
<title>FSMCaller_on_committed</title>
<ellipse fill="#555555" stroke="#555555" cx="857" cy="-419.77" rx="58.98" ry="18"/>
<text text-anchor="middle" x="857" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_committed</text>
</g>
<!-- BallotBox_commit_at&#45;&gt;FSMCaller_on_committed -->
<g id="edge48" class="edge">
<title>BallotBox_commit_at&#45;&gt;FSMCaller_on_committed</title>
<path fill="none" stroke="black" d="M857,-497.53C857,-483.75 857,-464.17 857,-448.23"/>
<polygon fill="black" stroke="black" points="860.5,-447.9 857,-437.9 853.5,-447.9 860.5,-447.9"/>
<text text-anchor="middle" x="914" y="-465.47" font-family="Times,serif" font-size="7.00">2. apply log until last_committed_index</text>
</g>
<!-- anno_BallotBox_append_pending_task -->
<g id="node122" class="node">
<title>anno_BallotBox_append_pending_task</title>
<polygon fill="#555555" stroke="#555555" points="2031.5,-437.77 1924.5,-437.77 1924.5,-401.77 2037.5,-401.77 2037.5,-431.77 2031.5,-437.77"/>
<polyline fill="none" stroke="#555555" points="2031.5,-437.77 2031.5,-431.77 "/>
<polyline fill="none" stroke="#555555" points="2037.5,-431.77 2031.5,-431.77 "/>
<text text-anchor="middle" x="1981" y="-421.57" font-family="Times,serif" font-size="8.00" fill="#ffffff">access _pending_meta_queue</text>
<text text-anchor="middle" x="1981" y="-412.57" font-family="Times,serif" font-size="8.00" fill="#ffffff">and _closure_queue</text>
</g>
<!-- BallotBox_commit_at&#45;&gt;anno_BallotBox_append_pending_task -->
<g id="edge46" class="edge">
<title>BallotBox_commit_at&#45;&gt;anno_BallotBox_append_pending_task</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M905.31,-510.35C944.97,-506.77 1002.6,-501.71 1053,-497.77 1148.83,-490.28 1821.15,-453.33 1916,-437.77 1918.76,-437.32 1921.58,-436.8 1924.41,-436.23"/>
</g>
<!-- anno_BallotBox_commit_at -->
<g id="node123" class="node">
<title>anno_BallotBox_commit_at</title>
<ellipse fill="#555555" stroke="#555555" cx="698" cy="-419.77" rx="64.19" ry="18"/>
<text text-anchor="middle" x="698" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">update last_committed_index</text>
</g>
<!-- BallotBox_commit_at&#45;&gt;anno_BallotBox_commit_at -->
<g id="edge47" class="edge">
<title>BallotBox_commit_at&#45;&gt;anno_BallotBox_commit_at</title>
<path fill="none" stroke="black" d="M818.43,-503.82C801.1,-498.02 780.82,-489.96 764,-479.77 748.15,-470.17 732.59,-456.52 720.56,-444.77"/>
<polygon fill="black" stroke="black" points="722.74,-441.99 713.2,-437.38 717.78,-446.94 722.74,-441.99"/>
<text text-anchor="middle" x="808.5" y="-469.47" font-family="Times,serif" font-size="7.00">1. Ballot::grant, Ballot::granted</text>
<text text-anchor="middle" x="808.5" y="-461.47" font-family="Times,serif" font-size="7.00">if log committed by quorum</text>
</g>
<!-- BallotBox_append_pending_task&#45;&gt;anno_BallotBox_append_pending_task -->
<g id="edge14" class="edge">
<title>BallotBox_append_pending_task&#45;&gt;anno_BallotBox_append_pending_task</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1484.85,-1142.75C1570.01,-1120.01 1739,-1071.49 1739,-1044.77 1739,-1044.77 1739,-1044.77 1739,-514.77 1739,-494.99 1852.73,-458.16 1924.26,-436.94"/>
</g>
<!-- Ballot_granted -->
<g id="node47" class="node">
<title>Ballot_granted</title>
<ellipse fill="#555555" stroke="#555555" cx="2010" cy="-2039.49" rx="37.37" ry="18"/>
<text text-anchor="middle" x="2010" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">Ballot::granted</text>
</g>
<!-- Ballot_grant -->
<g id="node48" class="node">
<title>Ballot_grant</title>
<ellipse fill="#555555" stroke="#555555" cx="2098" cy="-2039.49" rx="32.8" ry="18"/>
<text text-anchor="middle" x="2098" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">Ballot::grant</text>
</g>
<!-- ConfigurationChangeDone_Run -->
<g id="node49" class="node">
<title>ConfigurationChangeDone_Run</title>
<ellipse fill="#555555" stroke="#555555" cx="1880" cy="-91" rx="69.4" ry="18"/>
<text text-anchor="middle" x="1880" y="-88.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">ConfigurationChangeDone::Run</text>
</g>
<!-- FSM_on_leader_start -->
<g id="node50" class="node">
<title>FSM_on_leader_start</title>
<ellipse fill="#555555" stroke="#555555" cx="1880" cy="-18" rx="94.95" ry="18"/>
<text text-anchor="middle" x="1880" y="-15.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">_node&#45;&gt;_options.fsm&#45;&gt;on_leader_start(_term)</text>
</g>
<!-- ConfigurationChangeDone_Run&#45;&gt;FSM_on_leader_start -->
<g id="edge15" class="edge">
<title>ConfigurationChangeDone_Run&#45;&gt;FSM_on_leader_start</title>
<path fill="none" stroke="black" d="M1880,-72.81C1880,-64.79 1880,-55.05 1880,-46.07"/>
<polygon fill="black" stroke="black" points="1883.5,-46.03 1880,-36.03 1876.5,-46.03 1883.5,-46.03"/>
</g>
<!-- WaitMeta_on_new_log -->
<g id="node53" class="node">
<title>WaitMeta_on_new_log</title>
<ellipse fill="#555555" stroke="#555555" cx="641" cy="-875.77" rx="55.04" ry="18"/>
<text text-anchor="middle" x="641" y="-873.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">WaiteMeta::on_new_log</text>
</g>
<!-- LogManager_run_on_new_log&#45;&gt;WaitMeta_on_new_log -->
<g id="edge21" class="edge">
<title>LogManager_run_on_new_log&#45;&gt;WaitMeta_on_new_log</title>
<path fill="none" stroke="black" d="M641,-937.46C641,-927.66 641,-915.19 641,-904.1"/>
<polygon fill="black" stroke="black" points="644.5,-904.03 641,-894.03 637.5,-904.03 644.5,-904.03"/>
</g>
<!-- Replicator__continue_sending -->
<g id="node115" class="node">
<title>Replicator__continue_sending</title>
<ellipse fill="#555555" stroke="#555555" cx="641" cy="-779.77" rx="66.23" ry="18"/>
<text text-anchor="middle" x="641" y="-777.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_continue_sending</text>
</g>
<!-- WaitMeta_on_new_log&#45;&gt;Replicator__continue_sending -->
<g id="edge22" class="edge">
<title>WaitMeta_on_new_log&#45;&gt;Replicator__continue_sending</title>
<path fill="none" stroke="red" d="M641,-857.53C641,-843.75 641,-824.17 641,-808.23"/>
<polygon fill="red" stroke="red" points="644.5,-807.9 641,-797.9 637.5,-807.9 644.5,-807.9"/>
<text text-anchor="middle" x="700" y="-833.47" font-family="Times,serif" font-size="7.00" fill="red">fn run_on_new_log is _continue_sending</text>
<text text-anchor="middle" x="700" y="-825.47" font-family="Times,serif" font-size="7.00" fill="red">notify replicator to send next entry</text>
<text text-anchor="middle" x="700" y="-817.47" font-family="Times,serif" font-size="7.00" fill="red">when last log responsed</text>
</g>
<!-- LogManager_notify_on_new_log -->
<g id="node55" class="node">
<title>LogManager_notify_on_new_log</title>
<ellipse fill="#555555" stroke="#555555" cx="544" cy="-419.77" rx="72.08" ry="18"/>
<text text-anchor="middle" x="544" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::notify_on_new_log</text>
</g>
<!-- LogManager_notify_on_new_log&#45;&gt;insert_wait_map -->
<g id="edge24" class="edge">
<title>LogManager_notify_on_new_log&#45;&gt;insert_wait_map</title>
<path fill="none" stroke="black" d="M534.12,-401.7C526.93,-389.28 517.07,-372.24 508.92,-358.16"/>
<polygon fill="black" stroke="black" points="511.9,-356.32 503.86,-349.42 505.84,-359.82 511.9,-356.32"/>
</g>
<!-- LogManager_wait -->
<g id="node57" class="node">
<title>LogManager_wait</title>
<ellipse fill="#555555" stroke="#555555" cx="577" cy="-515.77" rx="43.85" ry="18"/>
<text text-anchor="middle" x="577" y="-513.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::wait</text>
</g>
<!-- LogManager_wait&#45;&gt;LogManager_notify_on_new_log -->
<g id="edge23" class="edge">
<title>LogManager_wait&#45;&gt;LogManager_notify_on_new_log</title>
<path fill="none" stroke="red" d="M570.95,-497.53C566.06,-483.62 559.1,-463.79 553.48,-447.78"/>
<polygon fill="red" stroke="red" points="556.63,-446.18 550.01,-437.9 550.02,-448.5 556.63,-446.18"/>
<text text-anchor="middle" x="632.5" y="-473.47" font-family="Times,serif" font-size="7.00" fill="red">notify Replicator there is</text>
<text text-anchor="middle" x="632.5" y="-465.47" font-family="Times,serif" font-size="7.00" fill="red">a new log to replicate</text>
<text text-anchor="middle" x="632.5" y="-457.47" font-family="Times,serif" font-size="7.00" fill="red">the LogManager waits for the replication result</text>
</g>
<!-- AppendBatcher_append -->
<g id="node64" class="node">
<title>AppendBatcher_append</title>
<ellipse fill="#555555" stroke="#555555" cx="906" cy="-955.77" rx="54.41" ry="18"/>
<text text-anchor="middle" x="906" y="-953.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">AppendBatcher::append</text>
</g>
<!-- LogManager_disk_thread&#45;&gt;AppendBatcher_append -->
<g id="edge31" class="edge">
<title>LogManager_disk_thread&#45;&gt;AppendBatcher_append</title>
<path fill="none" stroke="black" d="M991.25,-1026.59C974.97,-1013.26 951.7,-994.2 933.58,-979.36"/>
<polygon fill="black" stroke="black" points="935.62,-976.5 925.66,-972.87 931.18,-981.92 935.62,-976.5"/>
<text text-anchor="middle" x="991" y="-997.47" font-family="Times,serif" font-size="7.00">!entries.empty()</text>
</g>
<!-- AppendBatcher_flush -->
<g id="node65" class="node">
<title>AppendBatcher_flush</title>
<ellipse fill="#555555" stroke="#555555" cx="1091" cy="-955.77" rx="50.47" ry="18"/>
<text text-anchor="middle" x="1091" y="-953.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">AppendBatcher::flush</text>
</g>
<!-- LogManager_disk_thread&#45;&gt;AppendBatcher_flush -->
<g id="edge32" class="edge">
<title>LogManager_disk_thread&#45;&gt;AppendBatcher_flush</title>
<path fill="none" stroke="black" d="M1026.42,-1026.19C1038.45,-1013.26 1055.32,-995.12 1068.81,-980.63"/>
<polygon fill="black" stroke="black" points="1071.65,-982.71 1075.89,-973.01 1066.52,-977.95 1071.65,-982.71"/>
<text text-anchor="middle" x="1097.5" y="-1001.47" font-family="Times,serif" font-size="7.00">force flush AppendBatcher</text>
<text text-anchor="middle" x="1097.5" y="-993.47" font-family="Times,serif" font-size="7.00">before return</text>
</g>
<!-- LogManager_start_disk_thread -->
<g id="node59" class="node">
<title>LogManager_start_disk_thread</title>
<ellipse fill="#555555" stroke="#555555" cx="946" cy="-1751.53" rx="67.5" ry="18"/>
<text text-anchor="middle" x="946" y="-1748.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::start_disk_thread</text>
</g>
<!-- bthread_execution_queue_start_disk_thread -->
<g id="node61" class="node">
<title>bthread_execution_queue_start_disk_thread</title>
<ellipse fill="#555555" stroke="#555555" cx="959" cy="-1671.53" rx="91.15" ry="18"/>
<text text-anchor="middle" x="959" y="-1668.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">bthread::execution_queue_start_disk_thread</text>
</g>
<!-- LogManager_start_disk_thread&#45;&gt;bthread_execution_queue_start_disk_thread -->
<g id="edge29" class="edge">
<title>LogManager_start_disk_thread&#45;&gt;bthread_execution_queue_start_disk_thread</title>
<path fill="none" stroke="black" d="M948.89,-1733.22C950.53,-1723.36 952.63,-1710.78 954.48,-1699.64"/>
<polygon fill="black" stroke="black" points="957.98,-1699.97 956.17,-1689.53 951.07,-1698.82 957.98,-1699.97"/>
</g>
<!-- LogManager_check_consistency -->
<g id="node60" class="node">
<title>LogManager_check_consistency</title>
<ellipse fill="#555555" stroke="#555555" cx="2219" cy="-2039.49" rx="70.17" ry="18"/>
<text text-anchor="middle" x="2219" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::check_consistency</text>
</g>
<!-- bthread_execution_queue_start_disk_thread&#45;&gt;LogManager_disk_thread -->
<g id="edge30" class="edge">
<title>bthread_execution_queue_start_disk_thread&#45;&gt;LogManager_disk_thread</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M962.5,-1653.27C965.38,-1637.51 969,-1613.56 969,-1592.53 969,-1592.53 969,-1592.53 969,-1155.15 969,-1121.08 968.82,-1110.76 983,-1079.77 984.66,-1076.13 986.79,-1072.54 989.12,-1069.13"/>
<polygon fill="red" stroke="red" points="991.97,-1071.17 995.21,-1061.09 986.39,-1066.95 991.97,-1071.17"/>
<text text-anchor="middle" x="1019" y="-1375.74" font-family="Times,serif" font-size="7.00">make it run in background bthread</text>
</g>
<!-- bthread_execution_queue_start_apply_queue&#45;&gt;NodeImpl_execute_applying_tasks -->
<g id="edge100" class="edge">
<title>bthread_execution_queue_start_apply_queue&#45;&gt;NodeImpl_execute_applying_tasks</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1708.53,-1407.65C1645.62,-1391.39 1549.83,-1366.64 1492.13,-1351.73"/>
</g>
<!-- LogManager_LogManager&#45;&gt;LogManager_start_disk_thread -->
<g id="edge37" class="edge">
<title>LogManager_LogManager&#45;&gt;LogManager_start_disk_thread</title>
<path fill="none" stroke="black" d="M921.5,-1829.29C925.94,-1815.38 932.27,-1795.56 937.38,-1779.54"/>
<polygon fill="black" stroke="black" points="940.83,-1780.26 940.53,-1769.67 934.16,-1778.13 940.83,-1780.26"/>
</g>
<!-- AppendBatcher_append&#45;&gt;AppendBatcher_flush -->
<g id="edge34" class="edge">
<title>AppendBatcher_append&#45;&gt;AppendBatcher_flush</title>
<path fill="none" stroke="black" d="M960.51,-955.77C982.41,-955.77 1007.76,-955.77 1030.25,-955.77"/>
<polygon fill="black" stroke="black" points="1030.36,-959.27 1040.36,-955.77 1030.36,-952.27 1030.36,-959.27"/>
<text text-anchor="middle" x="1000.49" y="-968.47" font-family="Times,serif" font-size="7.00">buffer is full</text>
<text text-anchor="middle" x="1000.49" y="-960.47" font-family="Times,serif" font-size="7.00">or reache config limit</text>
</g>
<!-- StableClosure_Run -->
<g id="node66" class="node">
<title>StableClosure_Run</title>
<ellipse fill="#555555" stroke="#555555" cx="1046" cy="-875.77" rx="44.62" ry="18"/>
<text text-anchor="middle" x="1046" y="-873.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">StableClosure::Run</text>
</g>
<!-- AppendBatcher_flush&#45;&gt;StableClosure_Run -->
<g id="edge36" class="edge">
<title>AppendBatcher_flush&#45;&gt;StableClosure_Run</title>
<path fill="none" stroke="black" d="M1081.24,-937.84C1075.24,-927.45 1067.44,-913.94 1060.71,-902.26"/>
<polygon fill="black" stroke="black" points="1063.62,-900.31 1055.59,-893.39 1057.56,-903.8 1063.62,-900.31"/>
<text text-anchor="middle" x="1112.5" y="-913.47" font-family="Times,serif" font-size="7.00">2. foreach _storage[i]&#45;&gt;Run()</text>
</g>
<!-- LogManager_append_to_storage -->
<g id="node67" class="node">
<title>LogManager_append_to_storage</title>
<ellipse fill="#555555" stroke="#555555" cx="1186" cy="-875.77" rx="70.81" ry="18"/>
<text text-anchor="middle" x="1186" y="-873.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">LogManager::append_to_storage</text>
</g>
<!-- AppendBatcher_flush&#45;&gt;LogManager_append_to_storage -->
<g id="edge35" class="edge">
<title>AppendBatcher_flush&#45;&gt;LogManager_append_to_storage</title>
<path fill="none" stroke="black" d="M1122.34,-941.62C1133.7,-935.93 1146.14,-928.55 1156,-919.77 1161.57,-914.81 1166.65,-908.61 1170.98,-902.49"/>
<polygon fill="black" stroke="black" points="1174.18,-903.98 1176.76,-893.71 1168.34,-900.13 1174.18,-903.98"/>
<text text-anchor="middle" x="1166" y="-913.47" font-family="Times,serif" font-size="7.00">1</text>
</g>
<!-- StableClosure_Run&#45;&gt;LeaderStableClosure_Run -->
<g id="edge33" class="edge">
<title>StableClosure_Run&#45;&gt;LeaderStableClosure_Run</title>
<path fill="none" stroke="black" d="M1040.86,-857.53C1036.72,-843.62 1030.82,-823.79 1026.04,-807.78"/>
<polygon fill="black" stroke="black" points="1029.31,-806.49 1023.1,-797.9 1022.6,-808.48 1029.31,-806.49"/>
</g>
<!-- SegmentLogStorage_append_entries -->
<g id="node68" class="node">
<title>SegmentLogStorage_append_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="1201" cy="-779.77" rx="76.65" ry="18"/>
<text text-anchor="middle" x="1201" y="-777.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">SegmentLogStorage::append_entries</text>
</g>
<!-- LogManager_append_to_storage&#45;&gt;SegmentLogStorage_append_entries -->
<g id="edge38" class="edge">
<title>LogManager_append_to_storage&#45;&gt;SegmentLogStorage_append_entries</title>
<path fill="none" stroke="black" d="M1188.75,-857.53C1190.95,-843.75 1194.07,-824.17 1196.62,-808.23"/>
<polygon fill="black" stroke="black" points="1200.15,-808.33 1198.27,-797.9 1193.23,-807.22 1200.15,-808.33"/>
</g>
<!-- SegmentLogStorage_open_segment -->
<g id="node69" class="node">
<title>SegmentLogStorage_open_segment</title>
<ellipse fill="#555555" stroke="#555555" cx="1080" cy="-691.77" rx="75.38" ry="18"/>
<text text-anchor="middle" x="1080" y="-689.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">SegmentLogStorage::open_segment</text>
</g>
<!-- SegmentLogStorage_append_entries&#45;&gt;SegmentLogStorage_open_segment -->
<g id="edge39" class="edge">
<title>SegmentLogStorage_append_entries&#45;&gt;SegmentLogStorage_open_segment</title>
<path fill="none" stroke="black" d="M1177.96,-762.39C1159.03,-748.94 1132.05,-729.76 1111.19,-714.94"/>
<polygon fill="black" stroke="black" points="1113.14,-712.03 1102.96,-709.09 1109.08,-717.73 1113.14,-712.03"/>
<text text-anchor="middle" x="1154" y="-733.47" font-family="Times,serif" font-size="7.00">1</text>
</g>
<!-- Segment_append -->
<g id="node71" class="node">
<title>Segment_append</title>
<ellipse fill="#555555" stroke="#555555" cx="1232" cy="-691.77" rx="41.32" ry="18"/>
<text text-anchor="middle" x="1232" y="-689.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Segment::append</text>
</g>
<!-- SegmentLogStorage_append_entries&#45;&gt;Segment_append -->
<g id="edge40" class="edge">
<title>SegmentLogStorage_append_entries&#45;&gt;Segment_append</title>
<path fill="none" stroke="black" d="M1207.12,-761.78C1211.5,-749.65 1217.47,-733.09 1222.46,-719.23"/>
<polygon fill="black" stroke="black" points="1225.79,-720.32 1225.89,-709.73 1219.2,-717.95 1225.79,-720.32"/>
<text text-anchor="middle" x="1222.5" y="-733.47" font-family="Times,serif" font-size="7.00">2</text>
</g>
<!-- Segment_sync -->
<g id="node72" class="node">
<title>Segment_sync</title>
<ellipse fill="#555555" stroke="#555555" cx="1345" cy="-691.77" rx="36.11" ry="18"/>
<text text-anchor="middle" x="1345" y="-689.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Segment::sync</text>
</g>
<!-- SegmentLogStorage_append_entries&#45;&gt;Segment_sync -->
<g id="edge41" class="edge">
<title>SegmentLogStorage_append_entries&#45;&gt;Segment_sync</title>
<path fill="none" stroke="black" d="M1227.75,-762.8C1252.19,-748.2 1288.35,-726.61 1314.03,-711.26"/>
<polygon fill="black" stroke="black" points="1315.86,-714.25 1322.65,-706.12 1312.27,-708.24 1315.86,-714.25"/>
<text text-anchor="middle" x="1315.5" y="-733.47" font-family="Times,serif" font-size="7.00">3. call sync explicitly</text>
</g>
<!-- Segment_create -->
<g id="node70" class="node">
<title>Segment_create</title>
<ellipse fill="#555555" stroke="#555555" cx="1089" cy="-603.77" rx="38.64" ry="18"/>
<text text-anchor="middle" x="1089" y="-601.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Segment::create</text>
</g>
<!-- SegmentLogStorage_open_segment&#45;&gt;Segment_create -->
<g id="edge44" class="edge">
<title>SegmentLogStorage_open_segment&#45;&gt;Segment_create</title>
<path fill="none" stroke="black" d="M1081.82,-673.37C1083.06,-661.52 1084.73,-645.59 1086.14,-632.06"/>
<polygon fill="black" stroke="black" points="1089.65,-632.16 1087.21,-621.85 1082.69,-631.43 1089.65,-632.16"/>
<text text-anchor="middle" x="1167" y="-649.47" font-family="Times,serif" font-size="7.00">create a new segment log file</text>
<text text-anchor="middle" x="1167" y="-641.47" font-family="Times,serif" font-size="7.00">when the current size &gt; FLAGS_raft_max_segment_size</text>
</g>
<!-- SegmentLogStorage_open_segment&#45;&gt;Segment_append -->
<!-- syscall_open -->
<g id="node73" class="node">
<title>syscall_open</title>
<ellipse fill="#555555" stroke="#555555" cx="1089" cy="-515.77" rx="27" ry="18"/>
<text text-anchor="middle" x="1089" y="-513.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">::open</text>
</g>
<!-- Segment_create&#45;&gt;syscall_open -->
<g id="edge45" class="edge">
<title>Segment_create&#45;&gt;syscall_open</title>
<path fill="none" stroke="black" d="M1089,-585.37C1089,-573.52 1089,-557.59 1089,-544.06"/>
<polygon fill="black" stroke="black" points="1092.5,-543.85 1089,-533.85 1085.5,-543.85 1092.5,-543.85"/>
</g>
<!-- Segment_append&#45;&gt;Segment_sync -->
<!-- raft_add_service -->
<g id="node74" class="node">
<title>raft_add_service</title>
<ellipse fill="#555555" stroke="#555555" cx="681" cy="-1591.53" rx="40.68" ry="18"/>
<text text-anchor="middle" x="681" y="-1588.83" font-family="Times,serif" font-size="8.00" fill="#ffffff">raft::add_service</text>
</g>
<!-- raft_add_service&#45;&gt;NodeManager_add_service -->
<g id="edge111" class="edge">
<title>raft_add_service&#45;&gt;NodeManager_add_service</title>
<path fill="none" stroke="black" d="M681,-1573.22C681,-1563.43 681,-1550.96 681,-1539.87"/>
<polygon fill="black" stroke="black" points="684.5,-1539.8 681,-1529.8 677.5,-1539.8 684.5,-1539.8"/>
<text text-anchor="middle" x="729" y="-1549.23" font-family="Times,serif" font-size="7.00">bind brpc server and braft service</text>
</g>
<!-- RaftServiceImpl_pre_vote -->
<g id="node76" class="node">
<title>RaftServiceImpl_pre_vote</title>
<ellipse fill="#555555" stroke="#555555" cx="142" cy="-1338.04" rx="58.35" ry="18"/>
<text text-anchor="middle" x="142" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::pre_vote</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_pre_vote -->
<g id="edge116" class="edge">
<title>RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_pre_vote</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M412.39,-1411.1C350.71,-1394.66 244.08,-1366.24 184.83,-1350.45"/>
</g>
<!-- RaftServiceImpl_request_vote -->
<g id="node77" class="node">
<title>RaftServiceImpl_request_vote</title>
<ellipse fill="#555555" stroke="#555555" cx="287" cy="-1338.04" rx="65.6" ry="18"/>
<text text-anchor="middle" x="287" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::request_vote</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_request_vote -->
<g id="edge117" class="edge">
<title>RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_request_vote</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M428.67,-1408.44C397.12,-1392.98 348.77,-1369.3 317.52,-1353.99"/>
</g>
<!-- RaftServiceImpl_append_entries -->
<g id="node78" class="node">
<title>RaftServiceImpl_append_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="460" cy="-1338.04" rx="70.17" ry="18"/>
<text text-anchor="middle" x="460" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::append_entries</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_append_entries -->
<g id="edge118" class="edge">
<title>RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_append_entries</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M460,-1406.64C460,-1391.93 460,-1370.86 460,-1356.16"/>
</g>
<!-- RaftServiceImpl_install_snapshot -->
<g id="node79" class="node">
<title>RaftServiceImpl_install_snapshot</title>
<ellipse fill="#555555" stroke="#555555" cx="638" cy="-1338.04" rx="72.08" ry="18"/>
<text text-anchor="middle" x="638" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::install_snapshot</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_install_snapshot -->
<g id="edge119" class="edge">
<title>RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_install_snapshot</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M492.23,-1408.44C524.49,-1393.08 573.83,-1369.59 606.01,-1354.27"/>
</g>
<!-- RaftServiceImpl_timeout_now -->
<g id="node80" class="node">
<title>RaftServiceImpl_timeout_now</title>
<ellipse fill="#555555" stroke="#555555" cx="822" cy="-1338.04" rx="66.23" ry="18"/>
<text text-anchor="middle" x="822" y="-1335.34" font-family="Times,serif" font-size="8.00" fill="#ffffff">RaftServiceImpl::timeout_now</text>
</g>
<!-- RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_timeout_now -->
<g id="edge120" class="edge">
<title>RaftServiceImpl_RaftServiceImpl&#45;&gt;RaftServiceImpl_timeout_now</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M504.11,-1410.42C516.34,-1406.88 529.64,-1403.17 542,-1400.04 620.97,-1380.02 713.48,-1360.65 769.89,-1349.29"/>
</g>
<!-- RaftServiceImpl_pre_vote&#45;&gt;NodeImpl_handle_prevote_request -->
<g id="edge121" class="edge">
<title>RaftServiceImpl_pre_vote&#45;&gt;NodeImpl_handle_prevote_request</title>
<path fill="none" stroke="black" d="M131.92,-1320.29C124.71,-1308.3 114.85,-1291.92 106.62,-1278.24"/>
<polygon fill="black" stroke="black" points="109.38,-1276.05 101.23,-1269.29 103.39,-1279.66 109.38,-1276.05"/>
<text text-anchor="middle" x="191" y="-1295.74" font-family="Times,serif" font-size="7.00">NodeManager::get(request&#45;&gt;group_id(), peer_id)</text>
</g>
<!-- RaftServiceImpl_request_vote&#45;&gt;NodeImpl_handle_request_vote_request -->
<g id="edge122" class="edge">
<title>RaftServiceImpl_request_vote&#45;&gt;NodeImpl_handle_request_vote_request</title>
<path fill="none" stroke="black" d="M283.16,-1319.89C280.55,-1308.28 277.06,-1292.72 274.09,-1279.44"/>
<polygon fill="black" stroke="black" points="277.44,-1278.4 271.84,-1269.41 270.61,-1279.94 277.44,-1278.4"/>
</g>
<!-- RaftServiceImpl_append_entries&#45;&gt;NodeImpl_handle_append_entries_request -->
<g id="edge123" class="edge">
<title>RaftServiceImpl_append_entries&#45;&gt;NodeImpl_handle_append_entries_request</title>
<path fill="none" stroke="black" d="M460,-1319.89C460,-1308.28 460,-1292.72 460,-1279.44"/>
<polygon fill="black" stroke="black" points="463.5,-1279.41 460,-1269.41 456.5,-1279.41 463.5,-1279.41"/>
</g>
<!-- RaftServiceImpl_install_snapshot&#45;&gt;NodeImpl_handle_install_snapshot_request -->
<g id="edge124" class="edge">
<title>RaftServiceImpl_install_snapshot&#45;&gt;NodeImpl_handle_install_snapshot_request</title>
<path fill="none" stroke="black" d="M641.84,-1319.89C644.45,-1308.28 647.94,-1292.72 650.91,-1279.44"/>
<polygon fill="black" stroke="black" points="654.39,-1279.94 653.16,-1269.41 647.56,-1278.4 654.39,-1279.94"/>
</g>
<!-- RaftServiceImpl_timeout_now&#45;&gt;NodeImpl_handle_timeout_now_request -->
<g id="edge125" class="edge">
<title>RaftServiceImpl_timeout_now&#45;&gt;NodeImpl_handle_timeout_now_request</title>
<path fill="none" stroke="black" d="M827.67,-1319.89C831.54,-1308.17 836.75,-1292.41 841.16,-1279.05"/>
<polygon fill="black" stroke="black" points="844.53,-1280.01 844.34,-1269.41 837.88,-1277.81 844.53,-1280.01"/>
</g>
<!-- FSMCaller_run -->
<g id="node84" class="node">
<title>FSMCaller_run</title>
<ellipse fill="#555555" stroke="#555555" cx="1396" cy="-331.38" rx="38.64" ry="18"/>
<text text-anchor="middle" x="1396" y="-328.68" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::run</text>
</g>
<!-- FSMCaller_do_committed -->
<g id="node94" class="node">
<title>FSMCaller_do_committed</title>
<ellipse fill="#555555" stroke="#555555" cx="1880" cy="-251" rx="58.98" ry="18"/>
<text text-anchor="middle" x="1880" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_committed</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_committed -->
<g id="edge58" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_committed</title>
<path fill="none" stroke="red" d="M1431.98,-324.56C1514.27,-311.23 1716.93,-278.41 1819.07,-261.87"/>
<polygon fill="red" stroke="red" points="1819.92,-265.28 1829.23,-260.22 1818.8,-258.37 1819.92,-265.28"/>
<text text-anchor="middle" x="1689.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType::COMMITTED</text>
</g>
<!-- FSMCaller_do_leader_start -->
<g id="node95" class="node">
<title>FSMCaller_do_leader_start</title>
<ellipse fill="#555555" stroke="#555555" cx="2200" cy="-251" rx="60.89" ry="18"/>
<text text-anchor="middle" x="2200" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_leader_start</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_leader_start -->
<g id="edge71" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_leader_start</title>
<path fill="none" stroke="black" d="M1433.43,-326.74C1559.63,-314.43 1970.63,-274.36 2133.07,-258.53"/>
<polygon fill="black" stroke="black" points="2133.79,-261.97 2143.4,-257.52 2133.11,-255 2133.79,-261.97"/>
<text text-anchor="middle" x="1863.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:LEADER_START</text>
</g>
<!-- FSMCaller_do_leader_stop -->
<g id="node96" class="node">
<title>FSMCaller_do_leader_stop</title>
<ellipse fill="#555555" stroke="#555555" cx="2370" cy="-251" rx="60.25" ry="18"/>
<text text-anchor="middle" x="2370" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_leader_stop</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_leader_stop -->
<g id="edge72" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_leader_stop</title>
<path fill="none" stroke="black" d="M1434.47,-329.06C1556.89,-324.54 1948.34,-307.83 2270,-269 2283.17,-267.41 2297.24,-265.29 2310.55,-263.08"/>
<polygon fill="black" stroke="black" points="2311.27,-266.5 2320.55,-261.38 2310.1,-259.6 2311.27,-266.5"/>
<text text-anchor="middle" x="2118.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:LEADER_STOP</text>
</g>
<!-- FSMCaller_do_on_error -->
<g id="node97" class="node">
<title>FSMCaller_do_on_error</title>
<ellipse fill="#555555" stroke="#555555" cx="796" cy="-251" rx="55.04" ry="18"/>
<text text-anchor="middle" x="796" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_on_error</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_on_error -->
<g id="edge73" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_on_error</title>
<path fill="none" stroke="black" d="M1357.9,-328.28C1287.13,-324.09 1130.71,-313.47 1000,-295 939.93,-286.51 925.27,-281.94 866,-269 860.29,-267.75 854.32,-266.39 848.39,-265.01"/>
<polygon fill="black" stroke="black" points="849.03,-261.56 838.5,-262.66 847.42,-268.37 849.03,-261.56"/>
<text text-anchor="middle" x="1027" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:ERROR</text>
</g>
<!-- FSMCaller_do_shutdown -->
<g id="node98" class="node">
<title>FSMCaller_do_shutdown</title>
<ellipse fill="#555555" stroke="#555555" cx="932" cy="-251" rx="57.08" ry="18"/>
<text text-anchor="middle" x="932" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_shutdown</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_shutdown -->
<g id="edge74" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_shutdown</title>
<path fill="none" stroke="black" d="M1357.94,-327.72C1300.26,-323.28 1187.42,-313.02 1093,-295 1055.05,-287.76 1012.88,-276.37 981.22,-267.13"/>
<polygon fill="black" stroke="black" points="981.91,-263.69 971.33,-264.22 979.93,-270.4 981.91,-263.69"/>
<text text-anchor="middle" x="1128.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:SHUTDOWN</text>
</g>
<!-- FSMCaller_do_snapshot_load -->
<g id="node99" class="node">
<title>FSMCaller_do_snapshot_load</title>
<ellipse fill="#555555" stroke="#555555" cx="1076" cy="-251" rx="65.6" ry="18"/>
<text text-anchor="middle" x="1076" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_snapshot_load</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_snapshot_load -->
<g id="edge75" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_snapshot_load</title>
<path fill="none" stroke="black" d="M1359.09,-325.91C1318.26,-320.49 1250.75,-310.18 1194,-295 1169.05,-288.32 1141.92,-278.62 1119.97,-270.12"/>
<polygon fill="black" stroke="black" points="1121.18,-266.83 1110.59,-266.43 1118.62,-273.35 1121.18,-266.83"/>
<text text-anchor="middle" x="1239" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:SNAPSHOT_LOAD</text>
</g>
<!-- FSMCaller_do_snapshot_save -->
<g id="node100" class="node">
<title>FSMCaller_do_snapshot_save</title>
<ellipse fill="#555555" stroke="#555555" cx="1237" cy="-251" rx="65.6" ry="18"/>
<text text-anchor="middle" x="1237" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_snapshot_save</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_snapshot_save -->
<g id="edge76" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_snapshot_save</title>
<path fill="none" stroke="black" d="M1364.41,-320.7C1345.54,-314.41 1321.36,-305.45 1301,-295 1289.28,-288.98 1277.11,-281.24 1266.57,-273.98"/>
<polygon fill="black" stroke="black" points="1268.33,-270.94 1258.14,-268.05 1264.3,-276.67 1268.33,-270.94"/>
<text text-anchor="middle" x="1345" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:SNAPSHOT_SAVE</text>
</g>
<!-- FSMCaller_do_start_following -->
<g id="node101" class="node">
<title>FSMCaller_do_start_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1392" cy="-251" rx="66.87" ry="18"/>
<text text-anchor="middle" x="1392" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_start_following</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_start_following -->
<g id="edge77" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_start_following</title>
<path fill="none" stroke="black" d="M1395.13,-313.38C1394.63,-303.48 1393.98,-290.77 1393.4,-279.49"/>
<polygon fill="black" stroke="black" points="1396.89,-279.05 1392.88,-269.25 1389.89,-279.41 1396.89,-279.05"/>
<text text-anchor="middle" x="1442.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:START_FOLLOWING</text>
</g>
<!-- FSMCaller_do_stop_following -->
<g id="node102" class="node">
<title>FSMCaller_do_stop_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1547" cy="-251" rx="66.87" ry="18"/>
<text text-anchor="middle" x="1547" y="-248.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::do_stop_following</text>
</g>
<!-- FSMCaller_run&#45;&gt;FSMCaller_do_stop_following -->
<g id="edge78" class="edge">
<title>FSMCaller_run&#45;&gt;FSMCaller_do_stop_following</title>
<path fill="none" stroke="black" d="M1428.89,-321.77C1448.78,-315.81 1474.22,-306.82 1495,-295 1504.47,-289.61 1513.92,-282.47 1522.12,-275.55"/>
<polygon fill="black" stroke="black" points="1524.63,-278 1529.85,-268.78 1520.02,-272.73 1524.63,-278"/>
<text text-anchor="middle" x="1553.5" y="-288.7" font-family="Times,serif" font-size="7.00">TaskType:STOP_FOLLOWING</text>
</g>
<!-- FSMCaller_on_committed&#45;&gt;FSMCaller_run -->
<g id="edge57" class="edge">
<title>FSMCaller_on_committed&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="red" d="M890.94,-405.04C921.74,-393.18 968.68,-376.6 1011,-367.77 1129.99,-342.94 1273.29,-335.53 1346.97,-333.32"/>
<polygon fill="red" stroke="red" points="1347.42,-336.81 1357.32,-333.03 1347.22,-329.81 1347.42,-336.81"/>
<text text-anchor="middle" x="1067.5" y="-377.47" font-family="Times,serif" font-size="7.00">bthread::execution_queue_execute</text>
<text text-anchor="middle" x="1067.5" y="-369.47" font-family="Times,serif" font-size="7.00">(fsm_bthread_queue_id, clousure_task)</text>
</g>
<!-- FSMCaller_on_leader_start -->
<g id="node86" class="node">
<title>FSMCaller_on_leader_start</title>
<ellipse fill="#555555" stroke="#555555" cx="1846" cy="-419.77" rx="60.89" ry="18"/>
<text text-anchor="middle" x="1846" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_leader_start</text>
</g>
<!-- FSMCaller_on_leader_start&#45;&gt;FSMCaller_run -->
<g id="edge63" class="edge">
<title>FSMCaller_on_leader_start&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1801.28,-407.5C1792.9,-405.51 1784.2,-403.51 1776,-401.77 1655.96,-376.26 1513.36,-351.76 1441.79,-339.87"/>
<polygon fill="black" stroke="black" points="1442.2,-336.39 1431.76,-338.21 1441.05,-343.29 1442.2,-336.39"/>
</g>
<!-- FSMCaller_on_leader_stop&#45;&gt;FSMCaller_run -->
<g id="edge64" class="edge">
<title>FSMCaller_on_leader_stop&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M2197.1,-413.13C2039.04,-397.2 1590.82,-352.02 1443.54,-337.18"/>
<polygon fill="black" stroke="black" points="1443.77,-333.68 1433.47,-336.16 1443.07,-340.65 1443.77,-333.68"/>
</g>
<!-- anno_FSMCaller_on_leader_stop -->
<g id="node125" class="node">
<title>anno_FSMCaller_on_leader_stop</title>
<polygon fill="#555555" stroke="#555555" points="2326.5,-349.38 2173.5,-349.38 2173.5,-313.38 2332.5,-313.38 2332.5,-343.38 2326.5,-349.38"/>
<polyline fill="none" stroke="#555555" points="2326.5,-349.38 2326.5,-343.38 "/>
<polyline fill="none" stroke="#555555" points="2332.5,-343.38 2326.5,-343.38 "/>
<text text-anchor="middle" x="2253" y="-328.68" font-family="Times,serif" font-size="8.00" fill="#ffffff">add bthread timer for transfer leader timeout</text>
</g>
<!-- FSMCaller_on_leader_stop&#45;&gt;anno_FSMCaller_on_leader_stop -->
<g id="edge94" class="edge">
<title>FSMCaller_on_leader_stop&#45;&gt;anno_FSMCaller_on_leader_stop</title>
<g id="a_edge94"><a xlink:href="/users/gavin/tmp/tmp.html">
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2253,-401.7C2253,-386.56 2253,-364.55 2253,-349.42"/>
</a>
</g>
</g>
<!-- FSMCaller_on_error -->
<g id="node88" class="node">
<title>FSMCaller_on_error</title>
<ellipse fill="#555555" stroke="#555555" cx="982" cy="-419.77" rx="48.43" ry="18"/>
<text text-anchor="middle" x="982" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_error</text>
</g>
<!-- FSMCaller_on_error&#45;&gt;FSMCaller_run -->
<g id="edge65" class="edge">
<title>FSMCaller_on_error&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1018.06,-407.64C1025.29,-405.57 1032.86,-403.51 1040,-401.77 1150.42,-374.89 1282.1,-351.42 1350.17,-339.92"/>
<polygon fill="black" stroke="black" points="1350.86,-343.35 1360.14,-338.24 1349.7,-336.45 1350.86,-343.35"/>
</g>
<!-- FSMCaller_on_shutdown -->
<g id="node89" class="node">
<title>FSMCaller_on_shutdown</title>
<ellipse fill="#555555" stroke="#555555" cx="1106" cy="-419.77" rx="57.08" ry="18"/>
<text text-anchor="middle" x="1106" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_shutdown</text>
</g>
<!-- FSMCaller_on_shutdown&#45;&gt;FSMCaller_run -->
<g id="edge66" class="edge">
<title>FSMCaller_on_shutdown&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1146.02,-406.85C1200.87,-390.51 1298.93,-361.3 1354.53,-344.74"/>
<polygon fill="black" stroke="black" points="1355.81,-348.01 1364.4,-341.8 1353.82,-341.3 1355.81,-348.01"/>
</g>
<!-- FSMCaller_on_snapshot_load -->
<g id="node90" class="node">
<title>FSMCaller_on_snapshot_load</title>
<ellipse fill="#555555" stroke="#555555" cx="1247" cy="-419.77" rx="65.6" ry="18"/>
<text text-anchor="middle" x="1247" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_snapshot_load</text>
</g>
<!-- FSMCaller_on_snapshot_load&#45;&gt;FSMCaller_run -->
<g id="edge67" class="edge">
<title>FSMCaller_on_snapshot_load&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1273.98,-403.13C1299.19,-388.51 1336.85,-366.68 1363.66,-351.14"/>
<polygon fill="black" stroke="black" points="1365.75,-353.97 1372.65,-345.92 1362.24,-347.91 1365.75,-353.97"/>
</g>
<!-- FSMCaller_on_snapshot_save -->
<g id="node91" class="node">
<title>FSMCaller_on_snapshot_save</title>
<ellipse fill="#555555" stroke="#555555" cx="1397" cy="-419.77" rx="65.6" ry="18"/>
<text text-anchor="middle" x="1397" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_snapshot_save</text>
</g>
<!-- FSMCaller_on_snapshot_save&#45;&gt;FSMCaller_run -->
<g id="edge68" class="edge">
<title>FSMCaller_on_snapshot_save&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1396.8,-401.7C1396.66,-389.75 1396.48,-373.53 1396.32,-359.78"/>
<polygon fill="black" stroke="black" points="1399.81,-359.37 1396.2,-349.42 1392.81,-359.46 1399.81,-359.37"/>
</g>
<!-- FSMCaller_on_start_following -->
<g id="node92" class="node">
<title>FSMCaller_on_start_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1548" cy="-419.77" rx="66.87" ry="18"/>
<text text-anchor="middle" x="1548" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_start_following</text>
</g>
<!-- FSMCaller_on_start_following&#45;&gt;FSMCaller_run -->
<g id="edge69" class="edge">
<title>FSMCaller_on_start_following&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1520.47,-403.13C1494.65,-388.45 1456.01,-366.49 1428.64,-350.93"/>
<polygon fill="black" stroke="black" points="1430.25,-347.82 1419.82,-345.92 1426.79,-353.91 1430.25,-347.82"/>
</g>
<!-- FSMCaller_on_stop_following -->
<g id="node93" class="node">
<title>FSMCaller_on_stop_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1700" cy="-419.77" rx="66.87" ry="18"/>
<text text-anchor="middle" x="1700" y="-417.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">FSMCaller::on_stop_following</text>
</g>
<!-- FSMCaller_on_stop_following&#45;&gt;FSMCaller_run -->
<g id="edge70" class="edge">
<title>FSMCaller_on_stop_following&#45;&gt;FSMCaller_run</title>
<path fill="none" stroke="black" d="M1655.8,-406.21C1597.39,-389.61 1495.22,-360.58 1437.96,-344.31"/>
<polygon fill="black" stroke="black" points="1438.72,-340.89 1428.15,-341.52 1436.81,-347.62 1438.72,-340.89"/>
</g>
<!-- StateMachine_on_apply -->
<g id="node103" class="node">
<title>StateMachine_on_apply</title>
<ellipse fill="#555555" stroke="#555555" cx="2177" cy="-171" rx="53.77" ry="18"/>
<text text-anchor="middle" x="2177" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_apply</text>
</g>
<!-- FSMCaller_do_committed&#45;&gt;StateMachine_on_apply -->
<g id="edge50" class="edge">
<title>FSMCaller_do_committed&#45;&gt;StateMachine_on_apply</title>
<path fill="none" stroke="red" d="M1923.59,-238.76C1970.6,-226.6 2047.65,-206.6 2114,-189 2118.07,-187.92 2122.28,-186.8 2126.51,-185.67"/>
<polygon fill="red" stroke="red" points="2127.6,-189 2136.35,-183.02 2125.78,-182.24 2127.6,-189"/>
<text text-anchor="middle" x="2076.5" y="-208.7" font-family="Times,serif" font-size="7.00">ENTRY_TYPE_DATA</text>
</g>
<!-- StateMachine_on_configuration_committed -->
<g id="node104" class="node">
<title>StateMachine_on_configuration_committed</title>
<ellipse fill="#555555" stroke="#555555" cx="1729" cy="-171" rx="90.38" ry="18"/>
<text text-anchor="middle" x="1729" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_configuration_committed</text>
</g>
<!-- FSMCaller_do_committed&#45;&gt;StateMachine_on_configuration_committed -->
<g id="edge62" class="edge">
<title>FSMCaller_do_committed&#45;&gt;StateMachine_on_configuration_committed</title>
<path fill="none" stroke="black" d="M1832.26,-240.38C1812.05,-234.94 1788.86,-226.79 1770,-215 1762.2,-210.13 1754.87,-203.44 1748.61,-196.78"/>
<polygon fill="black" stroke="black" points="1751.06,-194.27 1741.81,-189.1 1745.82,-198.91 1751.06,-194.27"/>
<text text-anchor="middle" x="1823" y="-208.7" font-family="Times,serif" font-size="7.00">ENTRY_TYPE_CONFIGURATION</text>
</g>
<!-- IteratorImpl_done -->
<g id="node120" class="node">
<title>IteratorImpl_done</title>
<ellipse fill="#555555" stroke="#555555" cx="1880" cy="-171" rx="43.22" ry="18"/>
<text text-anchor="middle" x="1880" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">IteratorImpl::done</text>
</g>
<!-- FSMCaller_do_committed&#45;&gt;IteratorImpl_done -->
<g id="edge59" class="edge">
<title>FSMCaller_do_committed&#45;&gt;IteratorImpl_done</title>
<path fill="none" stroke="black" d="M1880,-232.69C1880,-222.89 1880,-210.42 1880,-199.33"/>
<polygon fill="black" stroke="black" points="1883.5,-199.26 1880,-189.26 1876.5,-199.26 1883.5,-199.26"/>
<text text-anchor="middle" x="1919" y="-208.7" font-family="Times,serif" font-size="7.00">not ENTRY_TYPE_DATA</text>
</g>
<!-- anno_FSMCaller_do_committed -->
<g id="node124" class="node">
<title>anno_FSMCaller_do_committed</title>
<polygon fill="#555555" stroke="#555555" points="2099,-189 1941,-189 1941,-153 2105,-153 2105,-183 2099,-189"/>
<polyline fill="none" stroke="#555555" points="2099,-189 2099,-183 "/>
<polyline fill="none" stroke="#555555" points="2105,-183 2099,-183 "/>
<text text-anchor="middle" x="2023" y="-177.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">pop_closure_until()</text>
<text text-anchor="middle" x="2023" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">extract all closures those have been registered</text>
<text text-anchor="middle" x="2023" y="-159.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">for further processing</text>
</g>
<!-- FSMCaller_do_committed&#45;&gt;anno_FSMCaller_do_committed -->
<g id="edge60" class="edge">
<title>FSMCaller_do_committed&#45;&gt;anno_FSMCaller_do_committed</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1915.89,-236.6C1930.52,-230.64 1947.4,-223.14 1962,-215 1975.58,-207.43 1989.83,-197.51 2001.14,-189.1"/>
</g>
<!-- StateMachine_on_leader_start -->
<g id="node106" class="node">
<title>StateMachine_on_leader_start</title>
<ellipse fill="#555555" stroke="#555555" cx="2314" cy="-171" rx="65.46" ry="18"/>
<text text-anchor="middle" x="2314" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_leader_start</text>
</g>
<!-- FSMCaller_do_leader_start&#45;&gt;StateMachine_on_leader_start -->
<g id="edge80" class="edge">
<title>FSMCaller_do_leader_start&#45;&gt;StateMachine_on_leader_start</title>
<path fill="none" stroke="black" d="M2223.07,-234.22C2240.11,-222.56 2263.51,-206.55 2282.3,-193.69"/>
<polygon fill="black" stroke="black" points="2284.3,-196.56 2290.57,-188.03 2280.34,-190.79 2284.3,-196.56"/>
</g>
<!-- StateMachine_on_leader_stop -->
<g id="node107" class="node">
<title>StateMachine_on_leader_stop</title>
<ellipse fill="#555555" stroke="#555555" cx="2462" cy="-171" rx="64.83" ry="18"/>
<text text-anchor="middle" x="2462" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_leader_stop</text>
</g>
<!-- FSMCaller_do_leader_stop&#45;&gt;StateMachine_on_leader_stop -->
<g id="edge81" class="edge">
<title>FSMCaller_do_leader_stop&#45;&gt;StateMachine_on_leader_stop</title>
<path fill="none" stroke="black" d="M2389.06,-233.84C2402.3,-222.62 2420.12,-207.51 2434.84,-195.03"/>
<polygon fill="black" stroke="black" points="2437.28,-197.55 2442.65,-188.41 2432.75,-192.21 2437.28,-197.55"/>
</g>
<!-- StateMachine_on_error -->
<g id="node105" class="node">
<title>StateMachine_on_error</title>
<ellipse fill="#555555" stroke="#555555" cx="787" cy="-171" rx="52.51" ry="18"/>
<text text-anchor="middle" x="787" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_error</text>
</g>
<!-- FSMCaller_do_on_error&#45;&gt;StateMachine_on_error -->
<g id="edge79" class="edge">
<title>FSMCaller_do_on_error&#45;&gt;StateMachine_on_error</title>
<path fill="none" stroke="black" d="M794,-232.69C792.86,-222.83 791.41,-210.25 790.13,-199.1"/>
<polygon fill="black" stroke="black" points="793.58,-198.53 788.96,-188.99 786.63,-199.33 793.58,-198.53"/>
</g>
<!-- StateMachine_on_shutdown -->
<g id="node108" class="node">
<title>StateMachine_on_shutdown</title>
<ellipse fill="#555555" stroke="#555555" cx="920" cy="-171" rx="61.66" ry="18"/>
<text text-anchor="middle" x="920" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_shutdown</text>
</g>
<!-- FSMCaller_do_shutdown&#45;&gt;StateMachine_on_shutdown -->
<g id="edge82" class="edge">
<title>FSMCaller_do_shutdown&#45;&gt;StateMachine_on_shutdown</title>
<path fill="none" stroke="black" d="M929.34,-232.69C927.82,-222.83 925.88,-210.25 924.17,-199.1"/>
<polygon fill="black" stroke="black" points="927.59,-198.35 922.61,-188.99 920.68,-199.41 927.59,-198.35"/>
</g>
<!-- StateMachine_on_snapshot_load -->
<g id="node109" class="node">
<title>StateMachine_on_snapshot_load</title>
<ellipse fill="#555555" stroke="#555555" cx="1070" cy="-171" rx="69.54" ry="18"/>
<text text-anchor="middle" x="1070" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_snapshot_load</text>
</g>
<!-- FSMCaller_do_snapshot_load&#45;&gt;StateMachine_on_snapshot_load -->
<g id="edge83" class="edge">
<title>FSMCaller_do_snapshot_load&#45;&gt;StateMachine_on_snapshot_load</title>
<path fill="none" stroke="black" d="M1074.67,-232.69C1073.91,-222.89 1072.96,-210.42 1072.1,-199.33"/>
<polygon fill="black" stroke="black" points="1075.58,-198.96 1071.33,-189.26 1068.61,-199.5 1075.58,-198.96"/>
</g>
<!-- StateMachine_on_snapshot_save -->
<g id="node110" class="node">
<title>StateMachine_on_snapshot_save</title>
<ellipse fill="#555555" stroke="#555555" cx="1228" cy="-171" rx="70.17" ry="18"/>
<text text-anchor="middle" x="1228" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_snapshot_save</text>
</g>
<!-- FSMCaller_do_snapshot_save&#45;&gt;StateMachine_on_snapshot_save -->
<g id="edge84" class="edge">
<title>FSMCaller_do_snapshot_save&#45;&gt;StateMachine_on_snapshot_save</title>
<path fill="none" stroke="black" d="M1235,-232.69C1233.86,-222.83 1232.41,-210.25 1231.13,-199.1"/>
<polygon fill="black" stroke="black" points="1234.58,-198.53 1229.96,-188.99 1227.63,-199.33 1234.58,-198.53"/>
</g>
<!-- StateMachine_on_start_following -->
<g id="node111" class="node">
<title>StateMachine_on_start_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1388" cy="-171" rx="71.44" ry="18"/>
<text text-anchor="middle" x="1388" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_start_following</text>
</g>
<!-- FSMCaller_do_start_following&#45;&gt;StateMachine_on_start_following -->
<g id="edge85" class="edge">
<title>FSMCaller_do_start_following&#45;&gt;StateMachine_on_start_following</title>
<path fill="none" stroke="black" d="M1391.11,-232.69C1390.61,-222.89 1389.97,-210.42 1389.4,-199.33"/>
<polygon fill="black" stroke="black" points="1392.89,-199.07 1388.89,-189.26 1385.9,-199.43 1392.89,-199.07"/>
</g>
<!-- StateMachine_on_stop_following -->
<g id="node112" class="node">
<title>StateMachine_on_stop_following</title>
<ellipse fill="#555555" stroke="#555555" cx="1549" cy="-171" rx="71.44" ry="18"/>
<text text-anchor="middle" x="1549" y="-168.3" font-family="Times,serif" font-size="8.00" fill="#ffffff">StateMachine::on_stop_following</text>
</g>
<!-- FSMCaller_do_stop_following&#45;&gt;StateMachine_on_stop_following -->
<g id="edge86" class="edge">
<title>FSMCaller_do_stop_following&#45;&gt;StateMachine_on_stop_following</title>
<path fill="none" stroke="black" d="M1547.44,-232.69C1547.7,-222.89 1548.01,-210.42 1548.3,-199.33"/>
<polygon fill="black" stroke="black" points="1551.8,-199.35 1548.56,-189.26 1544.8,-199.17 1551.8,-199.35"/>
</g>
<!-- Replicator__wait_more_entries -->
<g id="node113" class="node">
<title>Replicator__wait_more_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="611" cy="-603.77" rx="67.5" ry="18"/>
<text text-anchor="middle" x="611" y="-601.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_wait_more_entries</text>
</g>
<!-- Replicator__wait_more_entries&#45;&gt;LogManager_wait -->
<g id="edge28" class="edge">
<title>Replicator__wait_more_entries&#45;&gt;LogManager_wait</title>
<path fill="none" stroke="red" d="M604.28,-585.78C599.49,-573.65 592.94,-557.09 587.46,-543.23"/>
<polygon fill="red" stroke="red" points="590.63,-541.74 583.7,-533.73 584.13,-544.31 590.63,-541.74"/>
<text text-anchor="middle" x="642" y="-561.47" font-family="Times,serif" font-size="7.00">async</text>
<text text-anchor="middle" x="642" y="-553.47" font-family="Times,serif" font-size="7.00">_options.log_manager&#45;&gt;wait()</text>
</g>
<!-- Replicator__send_entries -->
<g id="node114" class="node">
<title>Replicator__send_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="782" cy="-691.77" rx="56.95" ry="18"/>
<text text-anchor="middle" x="782" y="-689.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_send_entries</text>
</g>
<!-- Replicator__send_entries&#45;&gt;Replicator__wait_more_entries -->
<g id="edge51" class="edge">
<title>Replicator__send_entries&#45;&gt;Replicator__wait_more_entries</title>
<path fill="none" stroke="black" d="M736.02,-681.21C697.91,-672.99 648.76,-661.56 641,-655.77 632.57,-649.48 626.08,-640.06 621.33,-631.02"/>
<polygon fill="black" stroke="black" points="624.45,-629.42 617,-621.88 618.12,-632.42 624.45,-629.42"/>
<text text-anchor="middle" x="707.5" y="-645.47" font-family="Times,serif" font-size="7.00">if append_entries_request&#45;&gt;entries_size() == 0</text>
</g>
<!-- Replicator__on_rpc_returned -->
<g id="node117" class="node">
<title>Replicator__on_rpc_returned</title>
<ellipse fill="#555555" stroke="#555555" cx="850" cy="-603.77" rx="64.19" ry="18"/>
<text text-anchor="middle" x="850" y="-601.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_on_rpc_returned</text>
</g>
<!-- Replicator__send_entries&#45;&gt;Replicator__on_rpc_returned -->
<g id="edge54" class="edge">
<title>Replicator__send_entries&#45;&gt;Replicator__on_rpc_returned</title>
<path fill="none" stroke="black" d="M777.72,-673.49C776.1,-662.99 775.91,-649.75 782,-639.77 786.23,-632.84 792.32,-627.22 799.14,-622.68"/>
<polygon fill="black" stroke="black" points="801.19,-625.54 808.09,-617.5 797.68,-619.48 801.19,-625.54"/>
<text text-anchor="middle" x="827.5" y="-645.47" font-family="Times,serif" font-size="7.00">response.success(), rpc callback</text>
</g>
<!-- Replicator__continue_sending&#45;&gt;Replicator__send_entries -->
<g id="edge53" class="edge">
<title>Replicator__continue_sending&#45;&gt;Replicator__send_entries</title>
<path fill="none" stroke="black" d="M703.07,-773.25C725,-768.45 748.33,-759.68 765,-743.77 771.6,-737.47 775.64,-728.55 778.11,-719.92"/>
<polygon fill="black" stroke="black" points="781.54,-720.63 780.35,-710.11 774.71,-719.08 781.54,-720.63"/>
<text text-anchor="middle" x="807" y="-733.47" font-family="Times,serif" font-size="7.00">error_code != ESTOP</text>
</g>
<!-- Replicator__send_empty_entries -->
<g id="node116" class="node">
<title>Replicator__send_empty_entries</title>
<ellipse fill="#555555" stroke="#555555" cx="619" cy="-691.77" rx="70.17" ry="18"/>
<text text-anchor="middle" x="619" y="-689.07" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_send_empty_entries</text>
</g>
<!-- Replicator__continue_sending&#45;&gt;Replicator__send_empty_entries -->
<g id="edge52" class="edge">
<title>Replicator__continue_sending&#45;&gt;Replicator__send_empty_entries</title>
<path fill="none" stroke="red" d="M628.41,-761.8C625.02,-756.32 621.8,-750.03 620,-743.77 617.85,-736.28 617.06,-727.91 616.94,-720.16"/>
<polygon fill="red" stroke="red" points="620.44,-720.17 617.15,-710.1 613.45,-720.03 620.44,-720.17"/>
<text text-anchor="middle" x="692.5" y="-737.47" font-family="Times,serif" font-size="7.00">error_code == ETIMEDOUT</text>
<text text-anchor="middle" x="692.5" y="-729.47" font-family="Times,serif" font-size="7.00">timeout machanism keep the statemachine running</text>
</g>
<!-- Replicator__on_rpc_returned&#45;&gt;BallotBox_commit_at -->
<g id="edge56" class="edge">
<title>Replicator__on_rpc_returned&#45;&gt;BallotBox_commit_at</title>
<path fill="none" stroke="red" d="M849.7,-585.73C849.68,-575.8 849.93,-563.05 851,-551.77 851.24,-549.19 851.57,-546.52 851.94,-543.85"/>
<polygon fill="red" stroke="red" points="855.43,-544.22 853.55,-533.79 848.52,-543.11 855.43,-544.22"/>
<text text-anchor="middle" x="902.5" y="-561.47" font-family="Times,serif" font-size="7.00">follower received the log</text>
<text text-anchor="middle" x="902.5" y="-553.47" font-family="Times,serif" font-size="7.00">r&#45;&gt;_options.ballot_box&#45;&gt;commit_at</text>
</g>
<!-- Replicator__on_rpc_returned&#45;&gt;Replicator__send_entries -->
<g id="edge55" class="edge">
<title>Replicator__on_rpc_returned&#45;&gt;Replicator__send_entries</title>
<path fill="none" stroke="black" d="M866.07,-621.64C873.92,-631.97 880.26,-645.2 873,-655.77 865.44,-666.78 853.9,-674.32 841.55,-679.5"/>
<polygon fill="black" stroke="black" points="840.17,-676.27 831.99,-683.01 842.59,-682.84 840.17,-676.27"/>
<text text-anchor="middle" x="901.5" y="-645.47" font-family="Times,serif" font-size="7.00">call again if succ</text>
</g>
<!-- Replicator__on_heartbeat_returned -->
<g id="node118" class="node">
<title>Replicator__on_heartbeat_returned</title>
<ellipse fill="#555555" stroke="#555555" cx="2382" cy="-2039.49" rx="74.75" ry="18"/>
<text text-anchor="middle" x="2382" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::_on_heartbeat_returned</text>
</g>
<!-- Replicator_start -->
<g id="node119" class="node">
<title>Replicator_start</title>
<ellipse fill="#555555" stroke="#555555" cx="2514" cy="-2039.49" rx="39.28" ry="18"/>
<text text-anchor="middle" x="2514" y="-2036.79" font-family="Times,serif" font-size="8.00" fill="#ffffff">Replicator::start</text>
</g>
<!-- IteratorImpl_done&#45;&gt;ConfigurationChangeDone_Run -->
<g id="edge61" class="edge">
<title>IteratorImpl_done&#45;&gt;ConfigurationChangeDone_Run</title>
<path fill="none" stroke="black" d="M1880,-152.69C1880,-142.89 1880,-130.42 1880,-119.33"/>
<polygon fill="black" stroke="black" points="1883.5,-119.26 1880,-109.26 1876.5,-119.26 1883.5,-119.26"/>
<text text-anchor="middle" x="1899" y="-128.7" font-family="Times,serif" font-size="7.00">Closure::Run</text>
</g>
<!-- anno_ClosureQueue -->
<g id="node121" class="node">
<title>anno_ClosureQueue</title>
<polygon fill="#555555" stroke="#555555" points="2112,-349.38 1844,-349.38 1844,-313.38 2118,-313.38 2118,-343.38 2112,-349.38"/>
<polyline fill="none" stroke="#555555" points="2112,-349.38 2112,-343.38 "/>
<polyline fill="none" stroke="#555555" points="2118,-343.38 2112,-343.38 "/>
<text text-anchor="middle" x="1981" y="-333.18" font-family="Times,serif" font-size="8.00" fill="#ffffff">there is only ONE ClosureQueue which is created at NodeImpl::init_fsm_caller,</text>
<text text-anchor="middle" x="1981" y="-324.18" font-family="Times,serif" font-size="8.00" fill="#ffffff">this queue belongs to NodeImpl and shared with BallotBox and FSMCaller</text>
</g>
<!-- anno_BallotBox_append_pending_task&#45;&gt;anno_ClosureQueue -->
<g id="edge13" class="edge">
<title>anno_BallotBox_append_pending_task&#45;&gt;anno_ClosureQueue</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1981,-401.7C1981,-386.56 1981,-364.55 1981,-349.42"/>
</g>
<!-- anno_BallotBox_commit_at&#45;&gt;FSMCaller_on_committed -->
<!-- bthread_timer_add&#45;&gt;NodeImpl_handle_transfer_timeout -->
<g id="edge96" class="edge">
<title>bthread_timer_add&#45;&gt;NodeImpl_handle_transfer_timeout</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M2615.96,-401.7C2618.06,-389.63 2620.91,-373.21 2623.31,-359.37"/>
<polygon fill="blue" stroke="blue" points="2626.78,-359.87 2625.04,-349.42 2619.88,-358.67 2626.78,-359.87"/>
<text text-anchor="middle" x="2632.5" y="-373.47" font-family="Times,serif" font-size="7.00">timeout</text>
</g>
<!-- NodeImpl_init_timers&#45;&gt;ElectionTimer_run -->
<g id="edge98" class="edge">
<title>NodeImpl_init_timers&#45;&gt;ElectionTimer_run</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1459.6,-1902.47C1459.5,-1893.51 1459.39,-1884.07 1459.3,-1875.63"/>
<polygon fill="black" stroke="black" points="1462.8,-1875.56 1459.19,-1865.6 1455.8,-1875.64 1462.8,-1875.56"/>
</g>
<!-- bthread queue\n_apply_queue&#45;&gt;execute&#45;&gt;NodeImpl_execute_applying_tasks -->
<g id="edge131" class="edge">
<title>bthread queue\n_apply_queue&#45;&gt;execute&#45;&gt;NodeImpl_execute_applying_tasks</title>
<path fill="none" stroke="black" d="M1443,-1406.23C1443,-1394.79 1443,-1379.62 1443,-1366.6"/>
<polygon fill="black" stroke="black" points="1446.5,-1366.28 1443,-1356.28 1439.5,-1366.28 1446.5,-1366.28"/>
</g>
</g>

<!--
Copyright 2019, Gavin Chou, gavineaglechou@gmail.com

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->

<style>
.node {
  fill: blue;
}
.node:hover {
  fill: lightblue;
}
.fade {
  opacity: 0.2;
}
.fade:hover {
  opacity: 1.0;
}
.arrow-path {
  stroke: blue;
}
.arrow-head-tail {
  fill: blue;
  stroke: blue;
}
</style>

<script xlink:href="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.0.min.js"></script>
<script>
<![CDATA[

// configure to switch highlight effect
const HIGHLIGHT = 1;
const FADE = 2;
var style = HIGHLIGHT;

function processClick() {
  var allNodes = $('.node');
  var allEdges = $('.edge');
  var allNodeTitles = allNodes.find('title');
  var allEdgeTitles = allEdges.find('title');
  var nodeAreas = allNodes.find('[fill]'); // including text

  var nonHiClass = style == FADE ? 'fade' : 'none';
  var hiClass = style == FADE ? 'none' : 'node';
  var arrowPathClass = style == FADE ? 'none' : 'arrow-path';
  var arrowHeadTailClass = style == FADE ? 'none'  : 'arrow-head-tail';
  var arrowTextClass = 'none'; // always remains none;

  // TODO: only nodes and edges, which can be recorded and modified, should be
  //       considered
  clearHighlight = function() {
    allNodes.each(function(index) {
      $(this).find('[fill]:not(text)').attr('class', nonHiClass);
    });
    allEdges.each(function(index) {
      $(this).find('*').attr('class', nonHiClass);
    });
  }

  nodeAreas.click(function() {
    clearHighlight();
    // highlight current node first
    $(this).parent().find('[fill]:not(text)').attr('class', hiClass);
    // console.log($(this).parent());
    // console.log(title);
    var highlight = function(title) {
      // for all adj, Node
      allEdgeTitles.each(function(index) {
        // console.log($(this).text());
        var arrow = $(this).text().split('->'); // &#45;&gt;
        if (!(arrow[0] === title || arrow[1] === title)) {
          return;
        }
        // TODO: compare nodes that arrow heads attatched to
        $(this).parent().find('path').attr('class', arrowPathClass);
        $(this).parent().find('polygon').attr('class', arrowHeadTailClass);
        $(this).parent().find('text').attr('class', 'arrowTextClass');
        // console.log(arrow);
        allNodeTitles.each(function(index) {
          // process parent node only
          if (!($(this).text() === arrow[0])) {
            return;
          }
          if ($(this).parent().find('[fill]').attr('class') === hiClass) {
            return;
          }
          $(this).parent().find('[fill]:not(text)').attr('class', hiClass);
          highlight(arrow[0]);
        });
      });
    };
    var clickedTitle = $(this).parent().find('title').text();
    highlight(clickedTitle);
  });

  // cancel highlight
  window.addEventListener("keyup", function(evt) {
    if (evt.defaultPrevented || evt.key != "Escape") {
      return;
    }
    clearHighlight();
    evt.preventDefault();
  }, {passive: false});
}


scaleX = 1
scaleY = 1
scaleStep = 0.10
lastZoom = -1
const minZoomDelta = 30.0

function processZoom() {
  svg = $('svg');

  scaleX = parseInt(svg.attr('width').substr(0, svg.attr('width').length - 2))
  scaleY = parseInt(svg.attr('height').substr(0, svg.attr('height').length - 2))

  wheelHandle = function (evt) {
    if (evt.ctrlKey == true) {
      evt.preventDefault();
      // console.log(evt.wheelDelta + ' ' + Date.now() + ' ' + scaleX + ' ' + scaleY)
      if (lastZoom > 0 && Date.now() - lastZoom < minZoomDelta) {
        return false
      }
      rate = 0;
      if (evt.wheelDelta / 120 > 0) {
        // zoom in
        rate = scaleStep
        // console.log('scroll up');
        rate = (1 + scaleStep)
      } else {
        // zoom out
        // console.log('scroll down');
        rate = 1 / (1 + scaleStep)
      }
      scaleX = parseInt(scaleX * rate + 0.5)
      scaleY = parseInt(scaleY * rate + 0.5)

      svg.attr('width', scaleX + 'pt')
      svg.attr('height', scaleY + 'pt')
      // console.log('new size ' + scaleX + ' ' + scaleY + ' ' + evt.screenX + ' ' + evt.screenY)

      // get pointer offset in view ratio offset within svg
      // the ratio of cursor's position to the svg's top-left remains the same
      // after zooming/scrolling:
      // oldCursorX / oldSvgWidth == newCursorX / newSvgWidth
      // oldCursorX = oldScrollX + evt.screenX
      // newCursorX = newScrollX + evt.screenX
      oldScrollX = window.pageXOffset
      oldScrollY = window.pageYOffset
      scrollX = 0
      scrollY = 0
      if (scaleX > window.innerWidth) {
        scrollX = parseInt((oldScrollX + evt.screenX) * rate - evt.screenX + 0.5)
      }
      if (scaleY > window.innerHeight) {
        scrollY = parseInt((oldScrollY + evt.screenY) * rate - evt.screenY + 0.5)
      }
      window.scroll({top: scrollY, left: scrollX, behavor: 'smooth'})
      // console.log('scroll to fit cursor ' + scrollX + ' ' + scrollY)

      lastZoom = Date.now()

      // svg.attr('transform', 'scale(' + scaleX + ' ' + scaleY + ') ' + translate)
      // consume the event
      return false
    }
    return true
  }
  window.addEventListener("mousewheel", wheelHandle, {passive: false});
}

function instruction() {
  inst = "* click any node to highlight specific path\n"
  inst += "* press ESC to cancel highlight\n"
  inst += "* ctrl+scroll to zoom in/out"
  alert(inst);
}

$(document).ready(function() {
  processClick();
  processZoom();
  instruction();
});

]]>
</script>
<!--
vim: et ts=2 sw=2 ft=javascript:
-->
</svg>
